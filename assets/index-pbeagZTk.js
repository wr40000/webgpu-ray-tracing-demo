var zi=Object.defineProperty;var Ei=(r,t,e)=>t in r?zi(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var b=(r,t,e)=>(Ei(r,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();var se=1e-6,L=typeof Float32Array<"u"?Float32Array:Array;function ki(r){L=r}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});function Ti(){var r=new L(9);return L!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function Ct(){var r=new L(16);return L!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Bi(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Ee(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=t[8],c=t[9],d=t[10],f=t[11],m=t[12],p=t[13],g=t[14],x=t[15],S=e*o-i*a,A=e*h-n*a,M=e*l-s*a,w=i*h-n*o,z=i*l-s*o,C=n*l-s*h,G=u*p-c*m,N=u*g-d*m,E=u*x-f*m,B=c*g-d*p,O=c*x-f*p,R=d*x-f*g,k=S*R-A*O+M*B+w*E-z*N+C*G;return k?(k=1/k,r[0]=(o*R-h*O+l*B)*k,r[1]=(n*O-i*R-s*B)*k,r[2]=(p*C-g*z+x*w)*k,r[3]=(d*z-c*C-f*w)*k,r[4]=(h*E-a*R-l*N)*k,r[5]=(e*R-n*E+s*N)*k,r[6]=(g*M-m*C-x*A)*k,r[7]=(u*C-d*M+f*A)*k,r[8]=(a*O-o*E+l*G)*k,r[9]=(i*E-e*O-s*G)*k,r[10]=(m*z-p*M+x*S)*k,r[11]=(c*M-u*z-f*S)*k,r[12]=(o*N-a*B-h*G)*k,r[13]=(e*B-i*N+n*G)*k,r[14]=(p*A-m*w-g*S)*k,r[15]=(u*w-c*A+d*S)*k,r):null}function Oi(r,t,e){var i=e[0],n=e[1],s=e[2],a,o,h,l,u,c,d,f,m,p,g,x;return t===r?(r[12]=t[0]*i+t[4]*n+t[8]*s+t[12],r[13]=t[1]*i+t[5]*n+t[9]*s+t[13],r[14]=t[2]*i+t[6]*n+t[10]*s+t[14],r[15]=t[3]*i+t[7]*n+t[11]*s+t[15]):(a=t[0],o=t[1],h=t[2],l=t[3],u=t[4],c=t[5],d=t[6],f=t[7],m=t[8],p=t[9],g=t[10],x=t[11],r[0]=a,r[1]=o,r[2]=h,r[3]=l,r[4]=u,r[5]=c,r[6]=d,r[7]=f,r[8]=m,r[9]=p,r[10]=g,r[11]=x,r[12]=a*i+u*n+m*s+t[12],r[13]=o*i+c*n+p*s+t[13],r[14]=h*i+d*n+g*s+t[14],r[15]=l*i+f*n+x*s+t[15]),r}function Ri(r,t,e){var i=e[0],n=e[1],s=e[2];return r[0]=t[0]*i,r[1]=t[1]*i,r[2]=t[2]*i,r[3]=t[3]*i,r[4]=t[4]*n,r[5]=t[5]*n,r[6]=t[6]*n,r[7]=t[7]*n,r[8]=t[8]*s,r[9]=t[9]*s,r[10]=t[10]*s,r[11]=t[11]*s,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function Pi(r,t,e){var i=Math.sin(e),n=Math.cos(e),s=t[4],a=t[5],o=t[6],h=t[7],l=t[8],u=t[9],c=t[10],d=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=s*n+l*i,r[5]=a*n+u*i,r[6]=o*n+c*i,r[7]=h*n+d*i,r[8]=l*n-s*i,r[9]=u*n-a*i,r[10]=c*n-o*i,r[11]=d*n-h*i,r}function Ui(r,t,e){var i=Math.sin(e),n=Math.cos(e),s=t[0],a=t[1],o=t[2],h=t[3],l=t[8],u=t[9],c=t[10],d=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=s*n-l*i,r[1]=a*n-u*i,r[2]=o*n-c*i,r[3]=h*n-d*i,r[8]=s*i+l*n,r[9]=a*i+u*n,r[10]=o*i+c*n,r[11]=h*i+d*n,r}function Di(r,t,e){var i=Math.sin(e),n=Math.cos(e),s=t[0],a=t[1],o=t[2],h=t[3],l=t[4],u=t[5],c=t[6],d=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=s*n+l*i,r[1]=a*n+u*i,r[2]=o*n+c*i,r[3]=h*n+d*i,r[4]=l*n-s*i,r[5]=u*n-a*i,r[6]=c*n-o*i,r[7]=d*n-h*i,r}function Fi(r,t,e,i,n){var s=1/Math.tan(t/2),a;return r[0]=s/e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,n!=null&&n!==1/0?(a=1/(i-n),r[10]=n*a,r[14]=n*i*a):(r[10]=-1,r[14]=-i),r}function Ii(r,t,e,i){var n,s,a,o,h,l,u,c,d,f,m=t[0],p=t[1],g=t[2],x=i[0],S=i[1],A=i[2],M=e[0],w=e[1],z=e[2];return Math.abs(m-M)<se&&Math.abs(p-w)<se&&Math.abs(g-z)<se?Bi(r):(u=m-M,c=p-w,d=g-z,f=1/Math.hypot(u,c,d),u*=f,c*=f,d*=f,n=S*d-A*c,s=A*u-x*d,a=x*c-S*u,f=Math.hypot(n,s,a),f?(f=1/f,n*=f,s*=f,a*=f):(n=0,s=0,a=0),o=c*a-d*s,h=d*n-u*a,l=u*s-c*n,f=Math.hypot(o,h,l),f?(f=1/f,o*=f,h*=f,l*=f):(o=0,h=0,l=0),r[0]=n,r[1]=o,r[2]=u,r[3]=0,r[4]=s,r[5]=h,r[6]=c,r[7]=0,r[8]=a,r[9]=l,r[10]=d,r[11]=0,r[12]=-(n*m+s*p+a*g),r[13]=-(o*m+h*p+l*g),r[14]=-(u*m+c*p+d*g),r[15]=1,r)}function ot(){var r=new L(3);return L!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Li(r){var t=r[0],e=r[1],i=r[2];return Math.hypot(t,e,i)}function pt(r,t,e){var i=new L(3);return i[0]=r,i[1]=t,i[2]=e,i}function yi(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function Ni(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function Vi(r,t,e){return r[0]=t[0]*e[0],r[1]=t[1]*e[1],r[2]=t[2]*e[2],r}function Gi(r,t,e){return r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.min(t[2],e[2]),r}function Hi(r,t,e){return r[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r}function ue(r,t,e,i){return r[0]=t[0]+e[0]*i,r[1]=t[1]+e[1]*i,r[2]=t[2]+e[2]*i,r}function qi(r,t){var e=t[0],i=t[1],n=t[2],s=e*e+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),r[0]=t[0]*s,r[1]=t[1]*s,r[2]=t[2]*s,r}function Yi(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function et(r,t,e){var i=t[0],n=t[1],s=t[2],a=e[0],o=e[1],h=e[2];return r[0]=n*h-s*o,r[1]=s*a-i*h,r[2]=i*o-n*a,r}function Xi(r,t,e){var i=e[0],n=e[1],s=e[2],a=e[3],o=t[0],h=t[1],l=t[2],u=n*l-s*h,c=s*o-i*l,d=i*h-n*o,f=n*d-s*c,m=s*u-i*d,p=i*c-n*u,g=a*2;return u*=g,c*=g,d*=g,f*=2,m*=2,p*=2,r[0]=o+u+f,r[1]=h+c+m,r[2]=l+d+p,r}var ji=Li;(function(){var r=ot();return function(t,e,i,n,s,a){var o,h;for(e||(e=3),i||(i=0),n?h=Math.min(n*e+i,t.length):h=t.length,o=i;o<h;o+=e)r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],s(r,r,a),t[o]=r[0],t[o+1]=r[1],t[o+2]=r[2];return t}})();function Wi(){var r=new L(4);return L!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function $i(r,t){var e=t[0],i=t[1],n=t[2],s=t[3],a=e*e+i*i+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),r[0]=e*a,r[1]=i*a,r[2]=n*a,r[3]=s*a,r}(function(){var r=Wi();return function(t,e,i,n,s,a){var o,h;for(e||(e=4),i||(i=0),n?h=Math.min(n*e+i,t.length):h=t.length,o=i;o<h;o+=e)r[0]=t[o],r[1]=t[o+1],r[2]=t[o+2],r[3]=t[o+3],s(r,r,a),t[o]=r[0],t[o+1]=r[1],t[o+2]=r[2],t[o+3]=r[3];return t}})();function It(){var r=new L(4);return L!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function ke(r,t,e){e=e*.5;var i=Math.sin(e);return r[0]=i*t[0],r[1]=i*t[1],r[2]=i*t[2],r[3]=Math.cos(e),r}function Zi(r,t,e){var i=t[0],n=t[1],s=t[2],a=t[3],o=e[0],h=e[1],l=e[2],u=e[3];return r[0]=i*u+a*o+n*l-s*h,r[1]=n*u+a*h+s*o-i*l,r[2]=s*u+a*l+i*h-n*o,r[3]=a*u-i*o-n*h-s*l,r}function de(r,t,e,i){var n=t[0],s=t[1],a=t[2],o=t[3],h=e[0],l=e[1],u=e[2],c=e[3],d,f,m,p,g;return f=n*h+s*l+a*u+o*c,f<0&&(f=-f,h=-h,l=-l,u=-u,c=-c),1-f>se?(d=Math.acos(f),m=Math.sin(d),p=Math.sin((1-i)*d)/m,g=Math.sin(i*d)/m):(p=1-i,g=i),r[0]=p*n+g*h,r[1]=p*s+g*l,r[2]=p*a+g*u,r[3]=p*o+g*c,r}function Ji(r,t){var e=t[0]+t[4]+t[8],i;if(e>0)i=Math.sqrt(e+1),r[3]=.5*i,i=.5/i,r[0]=(t[5]-t[7])*i,r[1]=(t[6]-t[2])*i,r[2]=(t[1]-t[3])*i;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[n*3+n]&&(n=2);var s=(n+1)%3,a=(n+2)%3;i=Math.sqrt(t[n*3+n]-t[s*3+s]-t[a*3+a]+1),r[n]=.5*i,i=.5/i,r[3]=(t[s*3+a]-t[a*3+s])*i,r[s]=(t[s*3+n]+t[n*3+s])*i,r[a]=(t[a*3+n]+t[n*3+a])*i}return r}var Qi=Zi,De=$i;(function(){var r=ot(),t=pt(1,0,0),e=pt(0,1,0);return function(i,n,s){var a=Yi(n,s);return a<-.999999?(et(r,t,n),ji(r)<1e-6&&et(r,e,n),qi(r,r),ke(i,r,Math.PI),i):a>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(et(r,n,s),i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=1+a,De(i,i))}})();(function(){var r=It(),t=It();return function(e,i,n,s,a,o){return de(r,i,a,o),de(t,n,s,o),de(e,r,t,2*o*(1-o)),e}})();(function(){var r=Ti();return function(t,e,i,n){return r[0]=i[0],r[3]=i[1],r[6]=i[2],r[1]=n[0],r[4]=n[1],r[7]=n[2],r[2]=-e[0],r[5]=-e[1],r[8]=-e[2],De(t,Ji(t,r))}})();function Ki(){var r=new L(2);return L!=Float32Array&&(r[0]=0,r[1]=0),r}function tn(r,t){var e=new L(2);return e[0]=r,e[1]=t,e}function en(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r}(function(){var r=Ki();return function(t,e,i,n,s,a){var o,h;for(e||(e=2),i||(i=0),n?h=Math.min(n*e+i,t.length):h=t.length,o=i;o<h;o+=e)r[0]=t[o],r[1]=t[o+1],s(r,r,a),t[o]=r[0],t[o+1]=r[1];return t}})();ki(Array);class nn{constructor(t,e,i,n,s){b(this,"canvas");b(this,"verticalFOV",45);b(this,"nearClip",.1);b(this,"farClip",100);b(this,"translationSpeed",5);b(this,"rotationSpeed",3);b(this,"projection",Ct());b(this,"view",Ct());b(this,"inverseProjection",Ct());b(this,"inverseView",Ct());b(this,"position",ot());b(this,"forwardDirection",ot());b(this,"upDirection",ot());b(this,"move",!1);b(this,"translateX",0);b(this,"translateY",0);b(this,"translateZ",0);b(this,"rotate",!1);b(this,"mouseMovement",[0,0]);b(this,"updatePos",()=>{if(this.move){let t=ot();et(t,this.forwardDirection,this.upDirection),this.translateX!==0&&ue(this.position,this.position,t,this.translationSpeed*this.translateX),this.translateY!==0&&ue(this.position,this.position,this.upDirection,this.translationSpeed*this.translateY),this.translateZ!==0&&ue(this.position,this.position,this.forwardDirection,this.translationSpeed*this.translateZ),et(t,this.forwardDirection,this.upDirection),t=ot(),et(t,this.forwardDirection,this.upDirection);const e=tn(this.mouseMovement[0],this.mouseMovement[1]);en(e,e,.001);const i=e[1]*this.rotationSpeed,n=e[0]*this.rotationSpeed,s=It();ke(s,t,-i);const a=It();ke(a,this.upDirection,-n);const o=It();Qi(o,s,a),De(o,o),Xi(this.forwardDirection,this.forwardDirection,o),this.recalculateProjection(),this.recalculateView(),this.mouseMovement=[0,0]}});b(this,"recalculateProjection",()=>{Fi(this.projection,this.verticalFOV,this.canvas.width/this.canvas.height,this.nearClip,this.farClip),Ee(this.inverseProjection,this.projection)});b(this,"recalculateView",()=>{const t=ot();yi(t,this.position,this.forwardDirection),Ii(this.view,this.position,t,pt(0,1,0)),Ee(this.inverseView,this.view)});this.canvas=t,this.verticalFOV=e,this.nearClip=i,this.farClip=n,this.translationSpeed=s,this.rotationSpeed=3,this.forwardDirection=pt(0,0,-1),this.upDirection=pt(0,1,0),this.position=pt(0,0,18),this.recalculateProjection(),this.recalculateView(),document.addEventListener("mousedown",async l=>{if(l.button===2&&!document.pointerLockElement)try{await t.requestPointerLock({unadjustedMovement:!0})}catch{alert("Please left click the view before trying to move with right click.")}}),document.addEventListener("mouseup",()=>{document.exitPointerLock()}),document.addEventListener("pointerlockchange",()=>{document.pointerLockElement==t?(this.move=!0,document.addEventListener("mousemove",h),document.addEventListener("keydown",a),document.addEventListener("keyup",o)):(this.move=!1,document.removeEventListener("mousemove",h),document.removeEventListener("keydown",a))});const a=l=>{l.code==="KeyW"?this.translateZ=1:l.code==="KeyS"&&(this.translateZ=-1),l.code==="KeyD"?this.translateX=1:l.code==="KeyA"&&(this.translateX=-1),l.code==="KeyE"?this.translateY=1:l.code==="KeyQ"&&(this.translateY=-1)},o=l=>{l.code==="KeyW"?this.translateZ=0:l.code==="KeyS"&&(this.translateZ=0),l.code==="KeyD"?this.translateX=0:l.code==="KeyA"&&(this.translateX=0),l.code==="KeyE"?this.translateY=0:l.code==="KeyQ"&&(this.translateY=0)},h=l=>{this.mouseMovement[0]+=l.movementX,this.mouseMovement[1]+=l.movementY}}}class rn{constructor(){b(this,"minCorner");b(this,"leftChild");b(this,"maxCorner");b(this,"primitiveCount")}}class He{constructor(){b(this,"corners",[]);b(this,"normals");b(this,"uvs",[]);b(this,"color");b(this,"centroid");this.corners=[],this.normals=[]}build_from_center_and_offsets(t,e,i){this.corners=[],this.centroid=[0,0,0];const n=[.33333,.33333,.33333];e.forEach(h=>{var l=[t[0],t[1],t[2]];this.corners.push([l[0]+h[0],l[1]+h[1],l[2]+h[2]]);var u=[l[0],l[1],l[2]];Vi(u,u,n),yi(this.centroid,this.centroid,u)});const s=[this.corners[1][0]-this.corners[0][0],this.corners[1][1]-this.corners[0][1],this.corners[1][2]-this.corners[0][2]],a=[this.corners[1][0]-this.corners[0][0],this.corners[1][1]-this.corners[0][1],this.corners[1][2]-this.corners[0][2]];var o=[0,0,0];et(o,s,a),this.normals.push(o),this.normals.push(o),this.normals.push(o),this.color=i}make_centroid(){this.centroid=[(this.corners[0][0]+this.corners[1][0]+this.corners[2][0])/3,(this.corners[0][1]+this.corners[1][1]+this.corners[2][1])/3,(this.corners[0][2]+this.corners[1][2]+this.corners[2][2])/3]}}function fe(r){return r*Math.PI/180}/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const gi="159",xi=300,qe=1e3,$t=1001,Ye=1002,Xe=1003,sn=1006,an=1008,on=1009,hn=1014,ln=1015,cn=1020,un=1023,me=1026,je=1027,dn=3e3,pe=3001,_e="",ye="srgb",fn=515,We=35044,Zt=2e3,$e=2001;class Fe{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const n=this._listeners[t];if(n!==void 0){const s=n.indexOf(e);s!==-1&&n.splice(s,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const i=this._listeners[t.type];if(i!==void 0){t.target=this;const n=i.slice(0);for(let s=0,a=n.length;s<a;s++)n[s].call(this,t);t.target=null}}}const I=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function le(){const r=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(I[r&255]+I[r>>8&255]+I[r>>16&255]+I[r>>24&255]+"-"+I[t&255]+I[t>>8&255]+"-"+I[t>>16&15|64]+I[t>>24&255]+"-"+I[e&63|128]+I[e>>8&255]+"-"+I[e>>16&255]+I[e>>24&255]+I[i&255]+I[i>>8&255]+I[i>>16&255]+I[i>>24&255]).toLowerCase()}function tt(r,t,e){return Math.max(t,Math.min(e,r))}function Tt(r,t){switch(t.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function V(r,t){switch(t.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}class it{constructor(t=0,e=0){it.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(tt(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),s=this.x-t.x,a=this.y-t.y;return this.x=s*i-a*n+t.x,this.y=s*n+a*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class kt{constructor(t,e,i,n,s,a,o,h,l){kt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,i,n,s,a,o,h,l)}set(t,e,i,n,s,a,o,h,l){const u=this.elements;return u[0]=t,u[1]=n,u[2]=o,u[3]=e,u[4]=s,u[5]=h,u[6]=i,u[7]=a,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,s=this.elements,a=i[0],o=i[3],h=i[6],l=i[1],u=i[4],c=i[7],d=i[2],f=i[5],m=i[8],p=n[0],g=n[3],x=n[6],S=n[1],A=n[4],M=n[7],w=n[2],z=n[5],C=n[8];return s[0]=a*p+o*S+h*w,s[3]=a*g+o*A+h*z,s[6]=a*x+o*M+h*C,s[1]=l*p+u*S+c*w,s[4]=l*g+u*A+c*z,s[7]=l*x+u*M+c*C,s[2]=d*p+f*S+m*w,s[5]=d*g+f*A+m*z,s[8]=d*x+f*M+m*C,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=t[8];return e*a*u-e*o*l-i*s*u+i*o*h+n*s*l-n*a*h}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=t[8],c=u*a-o*l,d=o*h-u*s,f=l*s-a*h,m=e*c+i*d+n*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return t[0]=c*p,t[1]=(n*l-u*i)*p,t[2]=(o*i-n*a)*p,t[3]=d*p,t[4]=(u*e-n*h)*p,t[5]=(n*s-o*e)*p,t[6]=f*p,t[7]=(i*h-l*e)*p,t[8]=(a*e-i*s)*p,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,s,a,o){const h=Math.cos(s),l=Math.sin(s);return this.set(i*h,i*l,-i*(h*a+l*o)+a+t,-n*l,n*h,-n*(-l*a+h*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(ge.makeScale(t,e)),this}rotate(t){return this.premultiply(ge.makeRotation(-t)),this}translate(t,e){return this.premultiply(ge.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,i=t.elements;for(let n=0;n<9;n++)if(e[n]!==i[n])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const ge=new kt;function mn(r){for(let t=r.length-1;t>=0;--t)if(r[t]>=65535)return!0;return!1}function Ze(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}const Je={};function xe(r){r in Je||(Je[r]=!0,console.warn(r))}function be(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}let yt;class pn{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{yt===void 0&&(yt=Ze("canvas")),yt.width=t.width,yt.height=t.height;const i=yt.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=yt}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=Ze("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const n=i.getImageData(0,0,t.width,t.height),s=n.data;for(let a=0;a<s.length;a++)s[a]=be(s[a]/255)*255;return i.putImageData(n,0,0),e}else if(t.data){const e=t.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(be(e[i]/255)*255):e[i]=be(e[i]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let _n=0;class yn{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:_n++}),this.uuid=le(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let a=0,o=n.length;a<o;a++)n[a].isDataTexture?s.push(ve(n[a].image)):s.push(ve(n[a]))}else s=ve(n);i.url=s}return e||(t.images[this.uuid]=i),i}}function ve(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?pn.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let gn=0;class ht extends Fe{constructor(t=ht.DEFAULT_IMAGE,e=ht.DEFAULT_MAPPING,i=$t,n=$t,s=sn,a=an,o=un,h=on,l=ht.DEFAULT_ANISOTROPY,u=_e){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:gn++}),this.uuid=le(),this.name="",this.source=new yn(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=i,this.wrapT=n,this.magFilter=s,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=h,this.offset=new it(0,0),this.repeat=new it(1,1),this.center=new it(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new kt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof u=="string"?this.colorSpace=u:(xe("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=u===pe?ye:_e),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==xi)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case qe:t.x=t.x-Math.floor(t.x);break;case $t:t.x=t.x<0?0:1;break;case Ye:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case qe:t.y=t.y-Math.floor(t.y);break;case $t:t.y=t.y<0?0:1;break;case Ye:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return xe("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===ye?pe:dn}set encoding(t){xe("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===pe?ye:_e}}ht.DEFAULT_IMAGE=null;ht.DEFAULT_MAPPING=xi;ht.DEFAULT_ANISOTROPY=1;class Gt{constructor(t=0,e=0,i=0,n=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=n}static slerpFlat(t,e,i,n,s,a,o){let h=i[n+0],l=i[n+1],u=i[n+2],c=i[n+3];const d=s[a+0],f=s[a+1],m=s[a+2],p=s[a+3];if(o===0){t[e+0]=h,t[e+1]=l,t[e+2]=u,t[e+3]=c;return}if(o===1){t[e+0]=d,t[e+1]=f,t[e+2]=m,t[e+3]=p;return}if(c!==p||h!==d||l!==f||u!==m){let g=1-o;const x=h*d+l*f+u*m+c*p,S=x>=0?1:-1,A=1-x*x;if(A>Number.EPSILON){const w=Math.sqrt(A),z=Math.atan2(w,x*S);g=Math.sin(g*z)/w,o=Math.sin(o*z)/w}const M=o*S;if(h=h*g+d*M,l=l*g+f*M,u=u*g+m*M,c=c*g+p*M,g===1-o){const w=1/Math.sqrt(h*h+l*l+u*u+c*c);h*=w,l*=w,u*=w,c*=w}}t[e]=h,t[e+1]=l,t[e+2]=u,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,n,s,a){const o=i[n],h=i[n+1],l=i[n+2],u=i[n+3],c=s[a],d=s[a+1],f=s[a+2],m=s[a+3];return t[e]=o*m+u*c+h*f-l*d,t[e+1]=h*m+u*d+l*c-o*f,t[e+2]=l*m+u*f+o*d-h*c,t[e+3]=u*m-o*c-h*d-l*f,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const i=t._x,n=t._y,s=t._z,a=t._order,o=Math.cos,h=Math.sin,l=o(i/2),u=o(n/2),c=o(s/2),d=h(i/2),f=h(n/2),m=h(s/2);switch(a){case"XYZ":this._x=d*u*c+l*f*m,this._y=l*f*c-d*u*m,this._z=l*u*m+d*f*c,this._w=l*u*c-d*f*m;break;case"YXZ":this._x=d*u*c+l*f*m,this._y=l*f*c-d*u*m,this._z=l*u*m-d*f*c,this._w=l*u*c+d*f*m;break;case"ZXY":this._x=d*u*c-l*f*m,this._y=l*f*c+d*u*m,this._z=l*u*m+d*f*c,this._w=l*u*c-d*f*m;break;case"ZYX":this._x=d*u*c-l*f*m,this._y=l*f*c+d*u*m,this._z=l*u*m-d*f*c,this._w=l*u*c+d*f*m;break;case"YZX":this._x=d*u*c+l*f*m,this._y=l*f*c+d*u*m,this._z=l*u*m-d*f*c,this._w=l*u*c-d*f*m;break;case"XZY":this._x=d*u*c-l*f*m,this._y=l*f*c-d*u*m,this._z=l*u*m+d*f*c,this._w=l*u*c+d*f*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],s=e[8],a=e[1],o=e[5],h=e[9],l=e[2],u=e[6],c=e[10],d=i+o+c;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(u-h)*f,this._y=(s-l)*f,this._z=(a-n)*f}else if(i>o&&i>c){const f=2*Math.sqrt(1+i-o-c);this._w=(u-h)/f,this._x=.25*f,this._y=(n+a)/f,this._z=(s+l)/f}else if(o>c){const f=2*Math.sqrt(1+o-i-c);this._w=(s-l)/f,this._x=(n+a)/f,this._y=.25*f,this._z=(h+u)/f}else{const f=2*Math.sqrt(1+c-i-o);this._w=(a-n)/f,this._x=(s+l)/f,this._y=(h+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(tt(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(i===0)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,s=t._z,a=t._w,o=e._x,h=e._y,l=e._z,u=e._w;return this._x=i*u+a*o+n*l-s*h,this._y=n*u+a*h+s*o-i*l,this._z=s*u+a*l+i*h-n*o,this._w=a*u-i*o-n*h-s*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const i=this._x,n=this._y,s=this._z,a=this._w;let o=a*t._w+i*t._x+n*t._y+s*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=i,this._y=n,this._z=s,this;const h=1-o*o;if(h<=Number.EPSILON){const f=1-e;return this._w=f*a+e*this._w,this._x=f*i+e*this._x,this._y=f*n+e*this._y,this._z=f*s+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(h),u=Math.atan2(l,o),c=Math.sin((1-e)*u)/l,d=Math.sin(e*u)/l;return this._w=a*c+this._w*d,this._x=i*c+this._x*d,this._y=n*c+this._y*d,this._z=s*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(s),i*Math.cos(s),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class v{constructor(t=0,e=0,i=0){v.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Qe.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Qe.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6]*n,this.y=s[1]*e+s[4]*i+s[7]*n,this.z=s[2]*e+s[5]*i+s[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,s=t.elements,a=1/(s[3]*e+s[7]*i+s[11]*n+s[15]);return this.x=(s[0]*e+s[4]*i+s[8]*n+s[12])*a,this.y=(s[1]*e+s[5]*i+s[9]*n+s[13])*a,this.z=(s[2]*e+s[6]*i+s[10]*n+s[14])*a,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,s=t.x,a=t.y,o=t.z,h=t.w,l=2*(a*n-o*i),u=2*(o*e-s*n),c=2*(s*i-a*e);return this.x=e+h*l+a*c-o*u,this.y=i+h*u+o*l-s*c,this.z=n+h*c+s*u-a*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n,this.y=s[1]*e+s[5]*i+s[9]*n,this.z=s[2]*e+s[6]*i+s[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,s=t.z,a=e.x,o=e.y,h=e.z;return this.x=n*h-s*o,this.y=s*a-i*h,this.z=i*o-n*a,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return we.copy(this).projectOnVector(t),this.sub(we)}reflect(t){return this.sub(we.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(tt(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const we=new v,Qe=new Gt;class Ht{constructor(t=new v(1/0,1/0,1/0),e=new v(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e+=3)this.expandByPoint(X.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,i=t.count;e<i;e++)this.expandByPoint(X.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=X.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(i!==void 0){const s=i.getAttribute("position");if(e===!0&&s!==void 0&&t.isInstancedMesh!==!0)for(let a=0,o=s.count;a<o;a++)t.isMesh===!0?t.getVertexPosition(a,X):X.fromBufferAttribute(s,a),X.applyMatrix4(t.matrixWorld),this.expandByPoint(X);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),Jt.copy(t.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),Jt.copy(i.boundingBox)),Jt.applyMatrix4(t.matrixWorld),this.union(Jt)}const n=t.children;for(let s=0,a=n.length;s<a;s++)this.expandByObject(n[s],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,X),X.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Bt),Qt.subVectors(this.max,Bt),gt.subVectors(t.a,Bt),xt.subVectors(t.b,Bt),bt.subVectors(t.c,Bt),rt.subVectors(xt,gt),st.subVectors(bt,xt),ft.subVectors(gt,bt);let e=[0,-rt.z,rt.y,0,-st.z,st.y,0,-ft.z,ft.y,rt.z,0,-rt.x,st.z,0,-st.x,ft.z,0,-ft.x,-rt.y,rt.x,0,-st.y,st.x,0,-ft.y,ft.x,0];return!Me(e,gt,xt,bt,Qt)||(e=[1,0,0,0,1,0,0,0,1],!Me(e,gt,xt,bt,Qt))?!1:(Kt.crossVectors(rt,st),e=[Kt.x,Kt.y,Kt.z],Me(e,gt,xt,bt,Qt))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,X).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(X).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(Q[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Q[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Q[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Q[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Q[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Q[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Q[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Q[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Q),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Q=[new v,new v,new v,new v,new v,new v,new v,new v],X=new v,Jt=new Ht,gt=new v,xt=new v,bt=new v,rt=new v,st=new v,ft=new v,Bt=new v,Qt=new v,Kt=new v,mt=new v;function Me(r,t,e,i,n){for(let s=0,a=r.length-3;s<=a;s+=3){mt.fromArray(r,s);const o=n.x*Math.abs(mt.x)+n.y*Math.abs(mt.y)+n.z*Math.abs(mt.z),h=t.dot(mt),l=e.dot(mt),u=i.dot(mt);if(Math.max(-Math.max(h,l,u),Math.min(h,l,u))>o)return!1}return!0}const xn=new Ht,Ot=new v,Se=new v;class bn{constructor(t=new v,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;e!==void 0?i.copy(e):xn.setFromPoints(t).getCenter(i);let n=0;for(let s=0,a=t.length;s<a;s++)n=Math.max(n,i.distanceToSquared(t[s]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Ot.subVectors(t,this.center);const e=Ot.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),n=(i-this.radius)*.5;this.center.addScaledVector(Ot,n/i),this.radius+=n}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(Se.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Ot.copy(t.center).add(Se)),this.expandByPoint(Ot.copy(t.center).sub(Se))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}class J{constructor(t,e,i,n,s,a,o,h,l,u,c,d,f,m,p,g){J.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,i,n,s,a,o,h,l,u,c,d,f,m,p,g)}set(t,e,i,n,s,a,o,h,l,u,c,d,f,m,p,g){const x=this.elements;return x[0]=t,x[4]=e,x[8]=i,x[12]=n,x[1]=s,x[5]=a,x[9]=o,x[13]=h,x[2]=l,x[6]=u,x[10]=c,x[14]=d,x[3]=f,x[7]=m,x[11]=p,x[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new J().fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/vt.setFromMatrixColumn(t,0).length(),s=1/vt.setFromMatrixColumn(t,1).length(),a=1/vt.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*s,e[5]=i[5]*s,e[6]=i[6]*s,e[7]=0,e[8]=i[8]*a,e[9]=i[9]*a,e[10]=i[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,n=t.y,s=t.z,a=Math.cos(i),o=Math.sin(i),h=Math.cos(n),l=Math.sin(n),u=Math.cos(s),c=Math.sin(s);if(t.order==="XYZ"){const d=a*u,f=a*c,m=o*u,p=o*c;e[0]=h*u,e[4]=-h*c,e[8]=l,e[1]=f+m*l,e[5]=d-p*l,e[9]=-o*h,e[2]=p-d*l,e[6]=m+f*l,e[10]=a*h}else if(t.order==="YXZ"){const d=h*u,f=h*c,m=l*u,p=l*c;e[0]=d+p*o,e[4]=m*o-f,e[8]=a*l,e[1]=a*c,e[5]=a*u,e[9]=-o,e[2]=f*o-m,e[6]=p+d*o,e[10]=a*h}else if(t.order==="ZXY"){const d=h*u,f=h*c,m=l*u,p=l*c;e[0]=d-p*o,e[4]=-a*c,e[8]=m+f*o,e[1]=f+m*o,e[5]=a*u,e[9]=p-d*o,e[2]=-a*l,e[6]=o,e[10]=a*h}else if(t.order==="ZYX"){const d=a*u,f=a*c,m=o*u,p=o*c;e[0]=h*u,e[4]=m*l-f,e[8]=d*l+p,e[1]=h*c,e[5]=p*l+d,e[9]=f*l-m,e[2]=-l,e[6]=o*h,e[10]=a*h}else if(t.order==="YZX"){const d=a*h,f=a*l,m=o*h,p=o*l;e[0]=h*u,e[4]=p-d*c,e[8]=m*c+f,e[1]=c,e[5]=a*u,e[9]=-o*u,e[2]=-l*u,e[6]=f*c+m,e[10]=d-p*c}else if(t.order==="XZY"){const d=a*h,f=a*l,m=o*h,p=o*l;e[0]=h*u,e[4]=-c,e[8]=l*u,e[1]=d*c+p,e[5]=a*u,e[9]=f*c-m,e[2]=m*c-f,e[6]=o*u,e[10]=p*c+d}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(vn,t,wn)}lookAt(t,e,i){const n=this.elements;return H.subVectors(t,e),H.lengthSq()===0&&(H.z=1),H.normalize(),at.crossVectors(i,H),at.lengthSq()===0&&(Math.abs(i.z)===1?H.x+=1e-4:H.z+=1e-4,H.normalize(),at.crossVectors(i,H)),at.normalize(),te.crossVectors(H,at),n[0]=at.x,n[4]=te.x,n[8]=H.x,n[1]=at.y,n[5]=te.y,n[9]=H.y,n[2]=at.z,n[6]=te.z,n[10]=H.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,s=this.elements,a=i[0],o=i[4],h=i[8],l=i[12],u=i[1],c=i[5],d=i[9],f=i[13],m=i[2],p=i[6],g=i[10],x=i[14],S=i[3],A=i[7],M=i[11],w=i[15],z=n[0],C=n[4],G=n[8],N=n[12],E=n[1],B=n[5],O=n[9],R=n[13],k=n[2],F=n[6],nt=n[10],qt=n[14],Yt=n[3],Xt=n[7],jt=n[11],Wt=n[15];return s[0]=a*z+o*E+h*k+l*Yt,s[4]=a*C+o*B+h*F+l*Xt,s[8]=a*G+o*O+h*nt+l*jt,s[12]=a*N+o*R+h*qt+l*Wt,s[1]=u*z+c*E+d*k+f*Yt,s[5]=u*C+c*B+d*F+f*Xt,s[9]=u*G+c*O+d*nt+f*jt,s[13]=u*N+c*R+d*qt+f*Wt,s[2]=m*z+p*E+g*k+x*Yt,s[6]=m*C+p*B+g*F+x*Xt,s[10]=m*G+p*O+g*nt+x*jt,s[14]=m*N+p*R+g*qt+x*Wt,s[3]=S*z+A*E+M*k+w*Yt,s[7]=S*C+A*B+M*F+w*Xt,s[11]=S*G+A*O+M*nt+w*jt,s[15]=S*N+A*R+M*qt+w*Wt,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],s=t[12],a=t[1],o=t[5],h=t[9],l=t[13],u=t[2],c=t[6],d=t[10],f=t[14],m=t[3],p=t[7],g=t[11],x=t[15];return m*(+s*h*c-n*l*c-s*o*d+i*l*d+n*o*f-i*h*f)+p*(+e*h*f-e*l*d+s*a*d-n*a*f+n*l*u-s*h*u)+g*(+e*l*c-e*o*f-s*a*c+i*a*f+s*o*u-i*l*u)+x*(-n*o*u-e*h*c+e*o*d+n*a*c-i*a*d+i*h*u)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=t[8],c=t[9],d=t[10],f=t[11],m=t[12],p=t[13],g=t[14],x=t[15],S=c*g*l-p*d*l+p*h*f-o*g*f-c*h*x+o*d*x,A=m*d*l-u*g*l-m*h*f+a*g*f+u*h*x-a*d*x,M=u*p*l-m*c*l+m*o*f-a*p*f-u*o*x+a*c*x,w=m*c*h-u*p*h-m*o*d+a*p*d+u*o*g-a*c*g,z=e*S+i*A+n*M+s*w;if(z===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const C=1/z;return t[0]=S*C,t[1]=(p*d*s-c*g*s-p*n*f+i*g*f+c*n*x-i*d*x)*C,t[2]=(o*g*s-p*h*s+p*n*l-i*g*l-o*n*x+i*h*x)*C,t[3]=(c*h*s-o*d*s-c*n*l+i*d*l+o*n*f-i*h*f)*C,t[4]=A*C,t[5]=(u*g*s-m*d*s+m*n*f-e*g*f-u*n*x+e*d*x)*C,t[6]=(m*h*s-a*g*s-m*n*l+e*g*l+a*n*x-e*h*x)*C,t[7]=(a*d*s-u*h*s+u*n*l-e*d*l-a*n*f+e*h*f)*C,t[8]=M*C,t[9]=(m*c*s-u*p*s-m*i*f+e*p*f+u*i*x-e*c*x)*C,t[10]=(a*p*s-m*o*s+m*i*l-e*p*l-a*i*x+e*o*x)*C,t[11]=(u*o*s-a*c*s-u*i*l+e*c*l+a*i*f-e*o*f)*C,t[12]=w*C,t[13]=(u*p*n-m*c*n+m*i*d-e*p*d-u*i*g+e*c*g)*C,t[14]=(m*o*n-a*p*n-m*i*h+e*p*h+a*i*g-e*o*g)*C,t[15]=(a*c*n-u*o*n+u*i*h-e*c*h-a*i*d+e*o*d)*C,this}scale(t){const e=this.elements,i=t.x,n=t.y,s=t.z;return e[0]*=i,e[4]*=n,e[8]*=s,e[1]*=i,e[5]*=n,e[9]*=s,e[2]*=i,e[6]*=n,e[10]*=s,e[3]*=i,e[7]*=n,e[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),s=1-i,a=t.x,o=t.y,h=t.z,l=s*a,u=s*o;return this.set(l*a+i,l*o-n*h,l*h+n*o,0,l*o+n*h,u*o+i,u*h-n*a,0,l*h-n*o,u*h+n*a,s*h*h+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,s,a){return this.set(1,i,s,0,t,1,a,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,s=e._x,a=e._y,o=e._z,h=e._w,l=s+s,u=a+a,c=o+o,d=s*l,f=s*u,m=s*c,p=a*u,g=a*c,x=o*c,S=h*l,A=h*u,M=h*c,w=i.x,z=i.y,C=i.z;return n[0]=(1-(p+x))*w,n[1]=(f+M)*w,n[2]=(m-A)*w,n[3]=0,n[4]=(f-M)*z,n[5]=(1-(d+x))*z,n[6]=(g+S)*z,n[7]=0,n[8]=(m+A)*C,n[9]=(g-S)*C,n[10]=(1-(d+p))*C,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let s=vt.set(n[0],n[1],n[2]).length();const a=vt.set(n[4],n[5],n[6]).length(),o=vt.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),t.x=n[12],t.y=n[13],t.z=n[14],j.copy(this);const l=1/s,u=1/a,c=1/o;return j.elements[0]*=l,j.elements[1]*=l,j.elements[2]*=l,j.elements[4]*=u,j.elements[5]*=u,j.elements[6]*=u,j.elements[8]*=c,j.elements[9]*=c,j.elements[10]*=c,e.setFromRotationMatrix(j),i.x=s,i.y=a,i.z=o,this}makePerspective(t,e,i,n,s,a,o=Zt){const h=this.elements,l=2*s/(e-t),u=2*s/(i-n),c=(e+t)/(e-t),d=(i+n)/(i-n);let f,m;if(o===Zt)f=-(a+s)/(a-s),m=-2*a*s/(a-s);else if(o===$e)f=-a/(a-s),m=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return h[0]=l,h[4]=0,h[8]=c,h[12]=0,h[1]=0,h[5]=u,h[9]=d,h[13]=0,h[2]=0,h[6]=0,h[10]=f,h[14]=m,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(t,e,i,n,s,a,o=Zt){const h=this.elements,l=1/(e-t),u=1/(i-n),c=1/(a-s),d=(e+t)*l,f=(i+n)*u;let m,p;if(o===Zt)m=(a+s)*c,p=-2*c;else if(o===$e)m=s*c,p=-1*c;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return h[0]=2*l,h[4]=0,h[8]=0,h[12]=-d,h[1]=0,h[5]=2*u,h[9]=0,h[13]=-f,h[2]=0,h[6]=0,h[10]=p,h[14]=-m,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let n=0;n<16;n++)if(e[n]!==i[n])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const vt=new v,j=new J,vn=new v(0,0,0),wn=new v(1,1,1),at=new v,te=new v,H=new v,Ke=new J,ti=new Gt;class ce{constructor(t=0,e=0,i=0,n=ce.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,s=n[0],a=n[4],o=n[8],h=n[1],l=n[5],u=n[9],c=n[2],d=n[6],f=n[10];switch(e){case"XYZ":this._y=Math.asin(tt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-tt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,f),this._z=Math.atan2(h,l)):(this._y=Math.atan2(-c,s),this._z=0);break;case"ZXY":this._x=Math.asin(tt(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-c,f),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(h,s));break;case"ZYX":this._y=Math.asin(-tt(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(h,s)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(tt(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-c,s)):(this._x=0,this._y=Math.atan2(o,f));break;case"XZY":this._z=Math.asin(-tt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return Ke.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Ke,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return ti.setFromEuler(this),this.setFromQuaternion(ti,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}ce.DEFAULT_ORDER="XYZ";class Mn{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let Sn=0;const ei=new v,wt=new Gt,K=new J,ee=new v,Rt=new v,An=new v,Cn=new Gt,ii=new v(1,0,0),ni=new v(0,1,0),ri=new v(0,0,1),zn={type:"added"},En={type:"removed"};class lt extends Fe{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Sn++}),this.uuid=le(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=lt.DEFAULT_UP.clone();const t=new v,e=new ce,i=new Gt,n=new v(1,1,1);function s(){i.setFromEuler(e,!1)}function a(){e.setFromQuaternion(i,void 0,!1)}e._onChange(s),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new J},normalMatrix:{value:new kt}}),this.matrix=new J,this.matrixWorld=new J,this.matrixAutoUpdate=lt.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=lt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Mn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return wt.setFromAxisAngle(t,e),this.quaternion.multiply(wt),this}rotateOnWorldAxis(t,e){return wt.setFromAxisAngle(t,e),this.quaternion.premultiply(wt),this}rotateX(t){return this.rotateOnAxis(ii,t)}rotateY(t){return this.rotateOnAxis(ni,t)}rotateZ(t){return this.rotateOnAxis(ri,t)}translateOnAxis(t,e){return ei.copy(t).applyQuaternion(this.quaternion),this.position.add(ei.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(ii,t)}translateY(t){return this.translateOnAxis(ni,t)}translateZ(t){return this.translateOnAxis(ri,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(K.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?ee.copy(t):ee.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),Rt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?K.lookAt(Rt,ee,this.up):K.lookAt(ee,Rt,this.up),this.quaternion.setFromRotationMatrix(K),n&&(K.extractRotation(n.matrixWorld),wt.setFromRotationMatrix(K),this.quaternion.premultiply(wt.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(zn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(En)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),K.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),K.multiply(t.parent.matrixWorld)),t.applyMatrix4(K),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const a=this.children[i].getObjectByProperty(t,e);if(a!==void 0)return a}}getObjectsByProperty(t,e,i=[]){this[t]===e&&i.push(this);const n=this.children;for(let s=0,a=n.length;s<a;s++)n[s].getObjectsByProperty(t,e,i);return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rt,t,An),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rt,Cn,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++){const s=e[i];(s.matrixWorldAutoUpdate===!0||t===!0)&&s.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const i=this.parent;if(t===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const n=this.children;for(let s=0,a=n.length;s<a;s++){const o=n[s];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),n.maxGeometryCount=this._maxGeometryCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(t),this.boundingSphere!==null&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),this.boundingBox!==null&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()}));function s(o,h){return o[h.uuid]===void 0&&(o[h.uuid]=h.toJSON(t)),h.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const h=o.shapes;if(Array.isArray(h))for(let l=0,u=h.length;l<u;l++){const c=h[l];s(t.shapes,c)}else s(t.shapes,h)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let h=0,l=this.material.length;h<l;h++)o.push(s(t.materials,this.material[h]));n.material=o}else n.material=s(t.materials,this.material);if(this.children.length>0){n.children=[];for(let o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let o=0;o<this.animations.length;o++){const h=this.animations[o];n.animations.push(s(t.animations,h))}}if(e){const o=a(t.geometries),h=a(t.materials),l=a(t.textures),u=a(t.images),c=a(t.shapes),d=a(t.skeletons),f=a(t.animations),m=a(t.nodes);o.length>0&&(i.geometries=o),h.length>0&&(i.materials=h),l.length>0&&(i.textures=l),u.length>0&&(i.images=u),c.length>0&&(i.shapes=c),d.length>0&&(i.skeletons=d),f.length>0&&(i.animations=f),m.length>0&&(i.nodes=m)}return i.object=n,i;function a(o){const h=[];for(const l in o){const u=o[l];delete u.metadata,h.push(u)}return h}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){const n=t.children[i];this.add(n.clone())}return this}}lt.DEFAULT_UP=new v(0,1,0);lt.DEFAULT_MATRIX_AUTO_UPDATE=!0;lt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const P=new v,ie=new it;class Et{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=i,this.usage=We,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=ln,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}get updateRange(){return console.warn('THREE.BufferAttribute: "updateRange" is deprecated and removed in r169. Use "addUpdateRange()" instead.'),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)ie.fromBufferAttribute(this,e),ie.applyMatrix3(t),this.setXY(e,ie.x,ie.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)P.fromBufferAttribute(this,e),P.applyMatrix3(t),this.setXYZ(e,P.x,P.y,P.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)P.fromBufferAttribute(this,e),P.applyMatrix4(t),this.setXYZ(e,P.x,P.y,P.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)P.fromBufferAttribute(this,e),P.applyNormalMatrix(t),this.setXYZ(e,P.x,P.y,P.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)P.fromBufferAttribute(this,e),P.transformDirection(t),this.setXYZ(e,P.x,P.y,P.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let i=this.array[t*this.itemSize+e];return this.normalized&&(i=Tt(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=V(i,this.array)),this.array[t*this.itemSize+e]=i,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Tt(e,this.array)),e}setX(t,e){return this.normalized&&(e=V(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Tt(e,this.array)),e}setY(t,e){return this.normalized&&(e=V(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Tt(e,this.array)),e}setZ(t,e){return this.normalized&&(e=V(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Tt(e,this.array)),e}setW(t,e){return this.normalized&&(e=V(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=V(e,this.array),i=V(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.normalized&&(e=V(e,this.array),i=V(i,this.array),n=V(n,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,s){return t*=this.itemSize,this.normalized&&(e=V(e,this.array),i=V(i,this.array),n=V(n,this.array),s=V(s,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==We&&(t.usage=this.usage),t}}class kn extends Et{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class Tn extends Et{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class ae extends Et{constructor(t,e,i){super(new Float32Array(t),e,i)}}let Bn=0;const Y=new J,Ae=new lt,Mt=new v,q=new Ht,Pt=new Ht,U=new v;class Ie extends Fe{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Bn++}),this.uuid=le(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(mn(t)?Tn:kn)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new kt().getNormalMatrix(t);i.applyNormalMatrix(s),i.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(t),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return Y.makeRotationFromQuaternion(t),this.applyMatrix4(Y),this}rotateX(t){return Y.makeRotationX(t),this.applyMatrix4(Y),this}rotateY(t){return Y.makeRotationY(t),this.applyMatrix4(Y),this}rotateZ(t){return Y.makeRotationZ(t),this.applyMatrix4(Y),this}translate(t,e,i){return Y.makeTranslation(t,e,i),this.applyMatrix4(Y),this}scale(t,e,i){return Y.makeScale(t,e,i),this.applyMatrix4(Y),this}lookAt(t){return Ae.lookAt(t),Ae.updateMatrix(),this.applyMatrix4(Ae.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Mt).negate(),this.translate(Mt.x,Mt.y,Mt.z),this}setFromPoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const s=t[i];e.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new ae(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ht);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new v(-1/0,-1/0,-1/0),new v(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,n=e.length;i<n;i++){const s=e[i];q.setFromBufferAttribute(s),this.morphTargetsRelative?(U.addVectors(this.boundingBox.min,q.min),this.boundingBox.expandByPoint(U),U.addVectors(this.boundingBox.max,q.max),this.boundingBox.expandByPoint(U)):(this.boundingBox.expandByPoint(q.min),this.boundingBox.expandByPoint(q.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new bn);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new v,1/0);return}if(t){const i=this.boundingSphere.center;if(q.setFromBufferAttribute(t),e)for(let s=0,a=e.length;s<a;s++){const o=e[s];Pt.setFromBufferAttribute(o),this.morphTargetsRelative?(U.addVectors(q.min,Pt.min),q.expandByPoint(U),U.addVectors(q.max,Pt.max),q.expandByPoint(U)):(q.expandByPoint(Pt.min),q.expandByPoint(Pt.max))}q.getCenter(i);let n=0;for(let s=0,a=t.count;s<a;s++)U.fromBufferAttribute(t,s),n=Math.max(n,i.distanceToSquared(U));if(e)for(let s=0,a=e.length;s<a;s++){const o=e[s],h=this.morphTargetsRelative;for(let l=0,u=o.count;l<u;l++)U.fromBufferAttribute(o,l),h&&(Mt.fromBufferAttribute(t,l),U.add(Mt)),n=Math.max(n,i.distanceToSquared(U))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.array,n=e.position.array,s=e.normal.array,a=e.uv.array,o=n.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Et(new Float32Array(4*o),4));const h=this.getAttribute("tangent").array,l=[],u=[];for(let E=0;E<o;E++)l[E]=new v,u[E]=new v;const c=new v,d=new v,f=new v,m=new it,p=new it,g=new it,x=new v,S=new v;function A(E,B,O){c.fromArray(n,E*3),d.fromArray(n,B*3),f.fromArray(n,O*3),m.fromArray(a,E*2),p.fromArray(a,B*2),g.fromArray(a,O*2),d.sub(c),f.sub(c),p.sub(m),g.sub(m);const R=1/(p.x*g.y-g.x*p.y);isFinite(R)&&(x.copy(d).multiplyScalar(g.y).addScaledVector(f,-p.y).multiplyScalar(R),S.copy(f).multiplyScalar(p.x).addScaledVector(d,-g.x).multiplyScalar(R),l[E].add(x),l[B].add(x),l[O].add(x),u[E].add(S),u[B].add(S),u[O].add(S))}let M=this.groups;M.length===0&&(M=[{start:0,count:i.length}]);for(let E=0,B=M.length;E<B;++E){const O=M[E],R=O.start,k=O.count;for(let F=R,nt=R+k;F<nt;F+=3)A(i[F+0],i[F+1],i[F+2])}const w=new v,z=new v,C=new v,G=new v;function N(E){C.fromArray(s,E*3),G.copy(C);const B=l[E];w.copy(B),w.sub(C.multiplyScalar(C.dot(B))).normalize(),z.crossVectors(G,B);const R=z.dot(u[E])<0?-1:1;h[E*4]=w.x,h[E*4+1]=w.y,h[E*4+2]=w.z,h[E*4+3]=R}for(let E=0,B=M.length;E<B;++E){const O=M[E],R=O.start,k=O.count;for(let F=R,nt=R+k;F<nt;F+=3)N(i[F+0]),N(i[F+1]),N(i[F+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Et(new Float32Array(e.count*3),3),this.setAttribute("normal",i);else for(let d=0,f=i.count;d<f;d++)i.setXYZ(d,0,0,0);const n=new v,s=new v,a=new v,o=new v,h=new v,l=new v,u=new v,c=new v;if(t)for(let d=0,f=t.count;d<f;d+=3){const m=t.getX(d+0),p=t.getX(d+1),g=t.getX(d+2);n.fromBufferAttribute(e,m),s.fromBufferAttribute(e,p),a.fromBufferAttribute(e,g),u.subVectors(a,s),c.subVectors(n,s),u.cross(c),o.fromBufferAttribute(i,m),h.fromBufferAttribute(i,p),l.fromBufferAttribute(i,g),o.add(u),h.add(u),l.add(u),i.setXYZ(m,o.x,o.y,o.z),i.setXYZ(p,h.x,h.y,h.z),i.setXYZ(g,l.x,l.y,l.z)}else for(let d=0,f=e.count;d<f;d+=3)n.fromBufferAttribute(e,d+0),s.fromBufferAttribute(e,d+1),a.fromBufferAttribute(e,d+2),u.subVectors(a,s),c.subVectors(n,s),u.cross(c),i.setXYZ(d+0,u.x,u.y,u.z),i.setXYZ(d+1,u.x,u.y,u.z),i.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)U.fromBufferAttribute(t,e),U.normalize(),t.setXYZ(e,U.x,U.y,U.z)}toNonIndexed(){function t(o,h){const l=o.array,u=o.itemSize,c=o.normalized,d=new l.constructor(h.length*u);let f=0,m=0;for(let p=0,g=h.length;p<g;p++){o.isInterleavedBufferAttribute?f=h[p]*o.data.stride+o.offset:f=h[p]*u;for(let x=0;x<u;x++)d[m++]=l[f++]}return new Et(d,u,c)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Ie,i=this.index.array,n=this.attributes;for(const o in n){const h=n[o],l=t(h,i);e.setAttribute(o,l)}const s=this.morphAttributes;for(const o in s){const h=[],l=s[o];for(let u=0,c=l.length;u<c;u++){const d=l[u],f=t(d,i);h.push(f)}e.morphAttributes[o]=h}e.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,h=a.length;o<h;o++){const l=a[o];e.addGroup(l.start,l.count,l.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const h=this.parameters;for(const l in h)h[l]!==void 0&&(t[l]=h[l]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const h in i){const l=i[h];t.data.attributes[h]=l.toJSON(t.data)}const n={};let s=!1;for(const h in this.morphAttributes){const l=this.morphAttributes[h],u=[];for(let c=0,d=l.length;c<d;c++){const f=l[c];u.push(f.toJSON(t.data))}u.length>0&&(n[h]=u,s=!0)}s&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;i!==null&&this.setIndex(i.clone(e));const n=t.attributes;for(const l in n){const u=n[l];this.setAttribute(l,u.clone(e))}const s=t.morphAttributes;for(const l in s){const u=[],c=s[l];for(let d=0,f=c.length;d<f;d++)u.push(c[d].clone(e));this.morphAttributes[l]=u}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let l=0,u=a.length;l<u;l++){const c=a[l];this.addGroup(c.start,c.count,c.materialIndex)}const o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());const h=t.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}class On extends ht{constructor(t,e,i,n,s,a,o,h,l,u){if(u=u!==void 0?u:me,u!==me&&u!==je)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&u===me&&(i=hn),i===void 0&&u===je&&(i=cn),super(null,n,s,a,o,h,u,i,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=o!==void 0?o:Xe,this.minFilter=h!==void 0?h:Xe,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}const Rn=new On(1,1);Rn.compareFunction=fn;class Le extends Ie{constructor(t=1,e=32,i=16,n=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:s,thetaStart:a,thetaLength:o},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));const h=Math.min(a+o,Math.PI);let l=0;const u=[],c=new v,d=new v,f=[],m=[],p=[],g=[];for(let x=0;x<=i;x++){const S=[],A=x/i;let M=0;x===0&&a===0?M=.5/e:x===i&&h===Math.PI&&(M=-.5/e);for(let w=0;w<=e;w++){const z=w/e;c.x=-t*Math.cos(n+z*s)*Math.sin(a+A*o),c.y=t*Math.cos(a+A*o),c.z=t*Math.sin(n+z*s)*Math.sin(a+A*o),m.push(c.x,c.y,c.z),d.copy(c).normalize(),p.push(d.x,d.y,d.z),g.push(z+M,1-A),S.push(l++)}u.push(S)}for(let x=0;x<i;x++)for(let S=0;S<e;S++){const A=u[x][S+1],M=u[x][S],w=u[x+1][S],z=u[x+1][S+1];(x!==0||a>0)&&f.push(A,M,z),(x!==i-1||h<Math.PI)&&f.push(M,w,z)}this.setIndex(f),this.setAttribute("position",new ae(m,3)),this.setAttribute("normal",new ae(p,3)),this.setAttribute("uv",new ae(g,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Le(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:gi}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=gi);class Pn{constructor(t,e){b(this,"v");b(this,"vt");b(this,"vn");b(this,"inverseModel");b(this,"triangles");b(this,"color");b(this,"position");b(this,"eulers");this.v=[],this.vt=[],this.vn=[],this.triangles=[],this.position=t,this.eulers=e,this.inverseModel=Ct(),this.calculate_transform()}update(t){this.eulers[1]+=t*.05,this.eulers[1]>360&&(this.eulers[1]-=360),this.calculate_transform()}calculate_transform(){let t=1;var e=Ct();Oi(e,e,this.position),Ri(e,e,[t,t,t]),Di(e,e,fe(this.eulers[2])),Ui(e,e,fe(this.eulers[1])),Pi(e,e,fe(this.eulers[0])),Ee(this.inverseModel,e)}async initialize(t,e){if(this.color=t,e=="A")try{let n=new Le(5,32,16),s=n.attributes.normal.array,a=n.attributes.uv.array,o=n.attributes.position.array,h=[],l=[],u=[];for(let d=0;d<(o==null?void 0:o.length)/3;d++){let f=[o[3*d],o[3*d+1],o[3*d+2]],m=[Number(s[3*d]).valueOf(),Number(s[3*d+1]).valueOf(),Number(s[3*d+2]).valueOf()],p=[Number(a[2*d]).valueOf(),Number(a[2*d+1]).valueOf()];h.push(f),l.push(m),u.push(p)}let c=n.index.array;for(let d=0;d<(c==null?void 0:c.length)/3;d++){var i=new He;i.corners.push(h[c[d*3]]),i.normals.push(l[Number(c[d*3]).valueOf()]),i.uvs.push(u[Number(c[d*3]).valueOf()]),i.corners.push(h[c[d*3+1]]),i.normals.push(l[Number(c[d*3+1]).valueOf()]),i.uvs.push(u[Number(c[d*3+1]).valueOf()]),i.corners.push(h[c[d*3+2]]),i.normals.push(l[Number(c[d*3+2]).valueOf()]),i.uvs.push(u[Number(c[d*3+2]).valueOf()]),i.color=this.color,i.make_centroid(),this.triangles.push(i)}return}catch{}await this.readFile(e)}async readFile(t){var e=[];(await(await(await fetch(t)).blob()).text()).split(`
`).forEach(o=>{o[0]=="v"&&o[1]==" "?this.read_vertex_data(o):o[0]=="v"&&o[1]=="t"?this.read_texcoord_data(o):o[0]=="v"&&o[1]=="n"?this.read_normal_data(o):o[0]=="f"&&this.read_face_data(o,e)})}read_vertex_data(t){const e=t.split(" "),i=[Number(e[1]).valueOf(),Number(e[2]).valueOf(),Number(e[3]).valueOf()];this.v.push(i)}read_texcoord_data(t){const e=t.split(" "),i=[Number(e[1]).valueOf(),Number(e[2]).valueOf()];this.vt.push(i)}read_normal_data(t){const e=t.split(" "),i=[Number(e[1]).valueOf(),Number(e[2]).valueOf(),Number(e[3]).valueOf()];this.vn.push(i)}read_face_data(t,e=[]){t=t.replace(`
`,"");const i=t.split(" "),n=i.length-3;for(var s=0;s<n;s++){var a=new He;this.read_corner(i[1],a),this.read_corner(i[2+s],a),this.read_corner(i[3+s],a),a.color=this.color,a.make_centroid(),this.triangles.push(a)}}read_corner(t,e){const i=t.split("/"),n=this.v[Number(i[0]).valueOf()-1],s=this.vt[Number(i[1]).valueOf()-1],a=this.vn[Number(i[2]).valueOf()-1];e.corners.push(n),e.normals.push(a),e.uvs.push(s)}}class Un{constructor(t){b(this,"camera");b(this,"statue");b(this,"triangles");b(this,"triangleCount");b(this,"triangleIndices");b(this,"nodes");b(this,"nodesUsed",0);this.camera=new nn(t,Math.PI/4,.1,1e4,.015)}async make_scene(){this.statue=new Pn([0,-1,0],[0,0,0]),await this.statue.initialize([0,0,0],"public/models/tree.obj"),this.triangles=[],this.statue.triangles.forEach(t=>{this.triangles.push(t)}),this.triangleCount=this.triangles.length,this.buildBVH()}update(t){this.statue.update(t/16.667)}buildBVH(){this.triangleIndices=new Array(this.triangles.length);for(var t=0;t<this.triangleCount;t+=1)this.triangleIndices[t]=t;this.nodes=new Array(2*this.triangles.length-1);for(var t=0;t<2*this.triangles.length-1;t+=1)this.nodes[t]=new rn;var e=this.nodes[0];e.leftChild=0,e.primitiveCount=this.triangles.length,this.nodesUsed+=1,this.updateBounds(0),this.subdivide(0)}updateBounds(t){var e=this.nodes[t];e.minCorner=[999999,999999,999999],e.maxCorner=[-999999,-999999,-999999];for(var i=0;i<e.primitiveCount;i+=1)this.triangles[this.triangleIndices[e.leftChild+i]].corners.forEach(s=>{Gi(e.minCorner,e.minCorner,s),Hi(e.maxCorner,e.maxCorner,s)})}subdivide(t){var e=this.nodes[t];if(e.primitiveCount<=2)return;var i=[0,0,0];Ni(i,e.maxCorner,e.minCorner);var n=0;i[1]>i[n]&&(n=1),i[2]>i[n]&&(n=2);const s=e.minCorner[n]+i[n]/2;for(var a=e.leftChild,o=a+e.primitiveCount-1;a<=o;)if(this.triangles[this.triangleIndices[a]].centroid[n]<s)a+=1;else{var h=this.triangleIndices[a];this.triangleIndices[a]=this.triangleIndices[o],this.triangleIndices[o]=h,o-=1}var l=a-e.leftChild;if(l==0||l==e.primitiveCount)return;const u=this.nodesUsed;this.nodesUsed+=1;const c=this.nodesUsed;this.nodesUsed+=1,this.nodes[u].leftChild=e.leftChild,this.nodes[u].primitiveCount=l,this.nodes[c].leftChild=a,this.nodes[c].primitiveCount=e.primitiveCount-l,e.leftChild=u,e.primitiveCount=0,this.updateBounds(u),this.updateBounds(c),this.subdivide(u),this.subdivide(c)}}const Dn=`struct Sphere{\r
    center: vec3<f32>,\r
    color: vec3<f32>,\r
    radius: f32,\r
}\r
\r
struct Triangle {\r
    corner_a: vec3<f32>,\r
    //float\r
    normal_a: vec3<f32>,\r
    //float\r
    corner_b: vec3<f32>,\r
    //float\r
    normal_b: vec3<f32>,\r
    //float\r
    corner_c: vec3<f32>,\r
    //float\r
    normal_c: vec3<f32>,\r
    //float\r
    color: vec3<f32>,\r
    //float\r
    uv_a: vec4<f32>,\r
    //float\r
    uv_b: vec4<f32>,\r
    //float\r
    uv_c: vec4<f32>,\r
}\r
\r
struct ObjectData {\r
    triangles: array<Triangle>,\r
}\r
\r
struct Node {\r
    minCorner: vec3<f32>,\r
    leftChild: f32,\r
    maxCorner: vec3<f32>,\r
    primitiveCount: f32,\r
}\r
\r
struct BVH {\r
    nodes: array<Node>,\r
}\r
\r
struct ObjectIndices {\r
    primitiveIndices: array<f32>,\r
}\r
\r
struct Ray {\r
    direction: vec3<f32>,\r
    origin: vec3<f32>,\r
}\r
\r
struct SceneData {\r
    cameraPos: vec3<f32>,\r
    cameraForwards: vec3<f32>,\r
    cameraRight: vec3<f32>,\r
    maxBounces: f32,\r
    cameraUp: vec3<f32>,\r
    primitiveCount: f32,\r
    inverseModel: mat4x4<f32>,\r
    dirLight: vec4<f32>\r
}\r
\r
struct RenderState {\r
    t: f32,\r
    color: vec3<f32>,\r
    hit: bool,\r
    position: vec3<f32>,\r
    normal: vec3<f32>,\r
}\r
\r
struct Camera {\r
  inverse_projection: mat4x4<f32>,\r
  inverse_view: mat4x4<f32>,\r
}\r
\r
const SAMPLES = 5;\r
\r
@group(0) @binding(0) var color_buffer: texture_storage_2d<rgba8unorm, write>;\r
@group(0) @binding(1) var<uniform> scene: SceneData;\r
@group(0) @binding(2) var<storage, read> objects: ObjectData;\r
@group(0) @binding(3) var<storage, read> tree: BVH;\r
@group(0) @binding(4) var<storage, read> triangleLookup: ObjectIndices;\r
@group(0) @binding(5) var skyTexture: texture_cube<f32>;\r
@group(0) @binding(6) var skySampler: sampler;\r
@group(0) @binding(7) var<uniform> random_seed: f32;\r
@group(0) @binding(8) var<uniform> camera: Camera;\r
@group(0) @binding(9) var obj_texture1: texture_2d<f32>;\r
\r
\r
\r
@compute @workgroup_size(16, 16, 1)\r
fn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {\r
    let screen_size: vec2<u32> = textureDimensions(color_buffer);\r
    let screen_pos : vec2<i32> = vec2<i32>(i32(GlobalInvocationID.x), i32(GlobalInvocationID.y));\r
\r
    let horizontal_coefficient: f32 = (f32(screen_pos.x) - f32(screen_size.x) / 2) / f32(screen_size.x);\r
    let vertical_coefficient: f32 = (f32(screen_pos.y) - f32(screen_size.y) / 2) / f32(screen_size.x);\r
\r
    let forwards: vec3<f32> = scene.cameraForwards;\r
    let right: vec3<f32> = scene.cameraRight;\r
    let up: vec3<f32> = scene.cameraUp;\r
\r
    //  <---\r
    let current_pixel = vec2<f32>(screen_pos);\r
    let pixel_center = (current_pixel + vec2(.5, .5)) / vec2<f32>(screen_size);\r
\r
    // stands for normalized device coordinate\r
    let ndc: vec2<f32> = vec2(2., -2.) * pixel_center + vec2(-1., 1.);\r
    let ray_target: vec4<f32> = camera.inverse_projection * vec4<f32>(ndc.x, ndc.y, 1., 1.);\r
    let pixel_ray_direction: vec4<f32> = camera.inverse_view * vec4<f32>(\r
        normalize(vec3<f32>(ray_target.xyz) / ray_target.w),\r
        0.\r
    );\r
    //  --->\r
\r
    var myRay: Ray;\r
    // myRay.direction = normalize(forwards + horizontal_coefficient * right + vertical_coefficient * up);\r
    myRay.direction = pixel_ray_direction.xyz;\r
    myRay.origin = scene.cameraPos;\r
\r
    let pixel_color : vec3<f32> = rayColor(myRay, GlobalInvocationID.x);\r
\r
    textureStore(color_buffer, screen_pos, vec4<f32>(pixel_color, 1.0));\r
}\r
\r
fn rayColor(ray: Ray, id:u32) -> vec3<f32> {\r
    // var color: vec3<f32> = vec3<f32>(1.0, 1.0, 1.0); \r
    var color: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0); //my\r
    var result: RenderState;\r
    var lightDir: vec3<f32> = vec3<f32>(scene.dirLight.xyz);\r
\r
    var world_ray: Ray;\r
    var object_ray: Ray;\r
    world_ray.origin = ray.origin;\r
    world_ray.direction = ray.direction;\r
    \r
    // 第四分量为0: 向量，为1：标量\r
    object_ray.origin = (scene.inverseModel * vec4<f32>(ray.origin, 1.0)).xyz;\r
    object_ray.direction = (scene.inverseModel * vec4<f32>(ray.direction, 0.0)).xyz;\r
\r
    let bounces: u32 = u32(scene.maxBounces);\r
    for (var sample = 0u; sample < SAMPLES; sample++) {\r
        var multiplier: vec3<f32> = vec3<f32>(1.0, 1.0, 1.0);\r
        for(var bounce: u32 = 0; bounce < bounces; bounce++){\r
            // temp_ray.origin += fract(sin(dot(\r
            //     vec2(f32(id)/exp2(14), random_seed),\r
            //     vec2(12.9898, 78.233)\r
            //     )) * 43758.5453)/100;\r
            result = trace(object_ray, lightDir, multiplier);\r
            //unpack color\r
            color += result.color * multiplier;   //my\r
            multiplier *= 0.5;\r
\r
            //early exit\r
            if (!result.hit) {\r
                //sky color\r
                color = color + multiplier * textureSampleLevel(skyTexture, skySampler, world_ray.direction, 0.0).xyz;\r
            }\r
            //Set up for next trace\r
            world_ray.origin = world_ray.origin + world_ray.direction * result.t;\r
            world_ray.direction = normalize(reflect(world_ray.direction, result.normal)); // 反射\r
            // world_ray.direction = normalize(refract(world_ray.direction, result.normal, f32(0.2))); // 折射\r
            \r
            object_ray.origin = (scene.inverseModel * vec4<f32>(world_ray.origin, 1.0)).xyz;\r
            object_ray.direction = (scene.inverseModel * vec4<f32>(world_ray.direction, 0.0)).xyz;\r
        }\r
\r
        //Rays which reached terminal state and bounced indefinitely\r
    }\r
        color /= SAMPLES;\r
        color = sqrt(color); // gamma correction ??? idk\r
        \r
    return color;\r
\r
}\r
\r
fn trace(ray: Ray, lightDir: vec3<f32>, multiplier: vec3<f32>) -> RenderState{\r
\r
    //Set up the Render State\r
    var renderState: RenderState;\r
    renderState.color = vec3<f32>(0.0, 0.0, 0.0);\r
    var hitSomething: bool = false;\r
    var nearestHit: f32 = 9999;\r
\r
    //Set up for BVH Traversal\r
    var node: Node = tree.nodes[0];\r
    var stack: array<Node, 15>;\r
    var stackLocation: u32 = 0;\r
\r
    while(true){\r
        var primitiveCount:u32 = u32(node.primitiveCount);\r
        var contents: u32 = u32(node.leftChild);\r
        if(primitiveCount == 0){\r
            var child1: Node = tree.nodes[contents];\r
            var child2: Node = tree.nodes[contents + 1];\r
\r
            var distance1:f32 = hit_aabb(ray, child1);\r
            var distance2:f32 = hit_aabb(ray, child2);\r
\r
            if(distance1 > distance2){\r
                var tempDist: f32 = distance1;\r
                distance1 = distance2;\r
                distance2 = tempDist;\r
\r
                var tempChild: Node = child1;\r
                child1 = child2;\r
                child2 = tempChild;\r
            }\r
            if(distance1 > nearestHit){\r
                if(stackLocation == 0){\r
                    break;\r
                }\r
                else{\r
                    stackLocation -= 1;\r
                    node = stack[stackLocation];\r
                }\r
            }\r
            else{\r
                node = child1;\r
                if(distance2 < nearestHit){\r
                    stack[stackLocation] = child2;\r
                    stackLocation += 1;\r
                }\r
            }\r
        }\r
        else{\r
            for(var i: u32 = 0; i < primitiveCount; i++){\r
\r
                var newRenderState: RenderState = hit_triangle(\r
                    ray, \r
                    objects.triangles[u32(triangleLookup.primitiveIndices[i + contents])], \r
                    0.001, \r
                    nearestHit, \r
                    renderState,\r
                    lightDir,\r
                    multiplier);\r
\r
                if(newRenderState.hit){\r
                    nearestHit = newRenderState.t;\r
                    renderState = newRenderState;\r
                    hitSomething = true;\r
                }\r
            }\r
\r
            if (stackLocation == 0) {\r
                break;\r
            }\r
            else {\r
                stackLocation -= 1;\r
                node = stack[stackLocation];\r
            }\r
        }\r
    }\r
\r
    return renderState;\r
}\r
\r
fn hit_sphere(\r
        ray: Ray, \r
        sphere: Sphere, \r
        tMin: f32, \r
        tMax: f32, \r
        oldRenderState: RenderState, \r
        lightDir: vec3<f32>,\r
        multiplier: vec3<f32>\r
    ) -> RenderState{\r
    \r
    let co: vec3<f32> = ray.origin - sphere.center;\r
    let a: f32 = dot(ray.direction, ray.direction); \r
    let b: f32 = 2.0 * dot(ray.direction, co);\r
    let c: f32 = dot(co, co) - sphere.radius * sphere.radius;\r
    let discriminant: f32 = b * b - 4.0 * a * c;\r
\r
    var renderState: RenderState;\r
    renderState.color = oldRenderState.color;\r
\r
    if(discriminant > 0.0){\r
        let t: f32  = (-b -sqrt(discriminant)) / (2 * a);\r
\r
        if(t > tMin && t < tMax){\r
            renderState.position = ray.origin + t * ray.direction;\r
            renderState.normal = normalize(renderState.position - sphere.center);\r
            renderState.t = t;\r
            renderState.hit = true;\r
            // renderState.color = sphere.color;\r
            let light_dir = normalize(lightDir);\r
            let light_intensity: f32 = max(dot(renderState.normal, -light_dir), 0.0f); // cos(angle)\r
            renderState.color += sphere.color * light_intensity * multiplier;\r
            return renderState;\r
        }\r
    }\r
\r
    renderState.hit = false;\r
    return renderState;\r
}\r
\r
fn hit_triangle(\r
    ray: Ray, \r
    tri: Triangle, \r
    tMin: f32, \r
    tMax: f32,\r
    oldRenderState: RenderState,\r
    lightDir: vec3<f32>,\r
    multiplier: vec3<f32>\r
  )-> RenderState{\r
    //Set up a blank renderstate,\r
    //right now this hasn't hit anything\r
    var renderState: RenderState;\r
    renderState.color = oldRenderState.color;\r
    renderState.hit = false;\r
\r
    //Direction vectors\r
    let edge_ab: vec3<f32> = tri.corner_b - tri.corner_a;\r
    let edge_ac: vec3<f32> = tri.corner_c - tri.corner_a;\r
    //Normal of the triangle\r
    var n: vec3<f32> = normalize(cross(edge_ab, edge_ac));\r
    var ray_dot_tri: f32 = dot(ray.direction, n);\r
    //backface reversal\r
    if (ray_dot_tri > 0.0) {\r
        ray_dot_tri = ray_dot_tri * -1;\r
        n = n * -1;\r
    }\r
    //early exit, ray parallel with triangle surface\r
    if (abs(ray_dot_tri) < 0.00001) {\r
        return renderState;\r
    }\r
\r
    var system_matrix: mat3x3<f32> = mat3x3<f32>(\r
        ray.direction,\r
        tri.corner_a - tri.corner_b,\r
        tri.corner_a - tri.corner_c\r
    );\r
    let denominator: f32 = determinant(system_matrix);\r
    // 测试，太小不行\r
    if (abs(denominator) < 0.00001) {\r
        return renderState;\r
    }\r
\r
    system_matrix = mat3x3<f32>(\r
        ray.direction,\r
        tri.corner_a - ray.origin,\r
        tri.corner_a - tri.corner_c\r
    );\r
    let u: f32 = determinant(system_matrix) / denominator;\r
    \r
    if (u < 0.0 || u > 1.0) {\r
        return renderState;\r
    }\r
\r
    system_matrix = mat3x3<f32>(\r
        ray.direction,\r
        tri.corner_a - tri.corner_b,\r
        tri.corner_a - ray.origin,\r
    );\r
    let v: f32 = determinant(system_matrix) / denominator;\r
    if (v < 0.0 || u + v > 1.0) {\r
        return renderState;\r
    }\r
\r
    system_matrix = mat3x3<f32>(\r
        tri.corner_a - ray.origin,\r
        tri.corner_a - tri.corner_b,\r
        tri.corner_a - tri.corner_c\r
    );\r
    let t: f32 = determinant(system_matrix) / denominator;\r
\r
    if (t > tMin && t < tMax) {\r
\r
        renderState.position = ray.origin + t * ray.direction;\r
        var normal: vec3<f32> = (1 - u - v) * tri.normal_a + u * tri.normal_b + v * tri.normal_c;\r
        var uv: vec2<f32> = (1 - u - v) * tri.uv_a.xy + u * tri.uv_b.xy + v * tri.uv_c.xy;\r
        renderState.normal = normalize(transpose(scene.inverseModel) * vec4<f32>(normal, 0.0)).xyz;     \r
        renderState.t = t;\r
        renderState.hit = true;\r
        let light_dir = normalize(transpose(scene.inverseModel) * vec4<f32>(lightDir, 0.0)).xyz;\r
        let light_intensity: f32 = max(dot(renderState.normal, -light_dir), 0.0f); // cos(angle)\r
        renderState.color += textureSampleLevel(obj_texture1, skySampler, uv, 0.0).xyz * light_intensity * multiplier;\r
        // renderState.color += tri.color * light_intensity * multiplier;\r
        return renderState;\r
    }\r
\r
    return renderState;\r
\r
}\r
\r
fn hit_aabb(ray: Ray, node: Node) -> f32 {\r
    var inverseDir: vec3<f32> = vec3(1.0) / ray.direction;\r
    var t1: vec3<f32> = (node.minCorner - ray.origin) * inverseDir;\r
    var t2: vec3<f32> = (node.maxCorner - ray.origin) * inverseDir;\r
    var tMin: vec3<f32> = min(t1, t2); // 取所有维度的最小值\r
    var tMax: vec3<f32> = max(t1, t2);  // 取所有维度的最大值\r
\r
    var t_min: f32 = max(max(tMin.x, tMin.y), tMin.z);\r
    var t_max: f32 = min(min(tMax.x, tMax.y), tMax.z);\r
\r
    if (t_min > t_max || t_max < 0) {\r
        return 99999;\r
    }\r
    else {\r
        return t_min;\r
    }\r
}\r
\r
`,si=`@group(0) @binding(0) var screen_sampler : sampler;\r
@group(0) @binding(1) var color_buffer : texture_2d<f32>;\r
\r
struct VertexOutput {\r
    @builtin(position) Position : vec4<f32>,\r
    @location(0) TexCoord : vec2<f32>,\r
}\r
\r
@vertex\r
fn vert_main(@builtin(vertex_index) VertexIndex : u32) -> VertexOutput {\r
\r
    var positions = array<vec2<f32>, 6>(\r
        vec2<f32>( 1.0,  1.0),\r
        vec2<f32>( 1.0, -1.0),\r
        vec2<f32>(-1.0, -1.0),\r
        vec2<f32>( 1.0,  1.0),\r
        vec2<f32>(-1.0, -1.0),\r
        vec2<f32>(-1.0,  1.0)\r
    );\r
\r
    var texCoords = array<vec2<f32>, 6>(\r
        vec2<f32>(1.0, 0.0),\r
        vec2<f32>(1.0, 1.0),\r
        vec2<f32>(0.0, 1.0),\r
        vec2<f32>(1.0, 0.0),\r
        vec2<f32>(0.0, 1.0),\r
        vec2<f32>(0.0, 0.0)\r
    );\r
\r
    var output : VertexOutput;\r
    output.Position = vec4<f32>(positions[VertexIndex], 0.0, 1.0);\r
    output.TexCoord = texCoords[VertexIndex];\r
    return output;\r
}\r
\r
@fragment\r
fn frag_main(@location(0) TexCoord : vec2<f32>) -> @location(0) vec4<f32> {\r
  return textureSample(color_buffer, screen_sampler, TexCoord);\r
}`;class Fn{constructor(){b(this,"texture");b(this,"view");b(this,"sampler")}async initialize(t,e){for(var i=new Array(6),n=0;n<6;n++){const h=await(await fetch(e[n])).blob();i[n]=await createImageBitmap(h)}await this.loadImageBitmaps(t,i);const s={format:"rgba8unorm",dimension:"cube",aspect:"all",baseMipLevel:0,mipLevelCount:1,baseArrayLayer:0,arrayLayerCount:6};this.view=this.texture.createView(s);const a={addressModeU:"repeat",addressModeV:"repeat",magFilter:"linear",minFilter:"nearest",mipmapFilter:"nearest",maxAnisotropy:1};this.sampler=t.createSampler(a)}async loadImageBitmaps(t,e){const i={dimension:"2d",size:{width:e[0].width,height:e[0].height,depthOrArrayLayers:6},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT};this.texture=t.createTexture(i);for(var n=0;n<6;n++)t.queue.copyExternalImageToTexture({source:e[n]},{texture:this.texture,origin:[0,0,n]},[e[n].width,e[n].height])}}function In(r){if(r&&!(typeof window>"u")){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=r,document.head.appendChild(t),r}}function zt(r,t){var e=r.__state.conversionName.toString(),i=Math.round(r.r),n=Math.round(r.g),s=Math.round(r.b),a=r.a,o=Math.round(r.h),h=r.s.toFixed(1),l=r.v.toFixed(1);if(t||e==="THREE_CHAR_HEX"||e==="SIX_CHAR_HEX"){for(var u=r.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}else{if(e==="CSS_RGB")return"rgb("+i+","+n+","+s+")";if(e==="CSS_RGBA")return"rgba("+i+","+n+","+s+","+a+")";if(e==="HEX")return"0x"+r.hex.toString(16);if(e==="RGB_ARRAY")return"["+i+","+n+","+s+"]";if(e==="RGBA_ARRAY")return"["+i+","+n+","+s+","+a+"]";if(e==="RGB_OBJ")return"{r:"+i+",g:"+n+",b:"+s+"}";if(e==="RGBA_OBJ")return"{r:"+i+",g:"+n+",b:"+s+",a:"+a+"}";if(e==="HSV_OBJ")return"{h:"+o+",s:"+h+",v:"+l+"}";if(e==="HSVA_OBJ")return"{h:"+o+",s:"+h+",v:"+l+",a:"+a+"}"}return"unknown format"}var ai=Array.prototype.forEach,Ut=Array.prototype.slice,y={BREAK:{},extend:function(t){return this.each(Ut.call(arguments,1),function(e){var i=this.isObject(e)?Object.keys(e):[];i.forEach((function(n){this.isUndefined(e[n])||(t[n]=e[n])}).bind(this))},this),t},defaults:function(t){return this.each(Ut.call(arguments,1),function(e){var i=this.isObject(e)?Object.keys(e):[];i.forEach((function(n){this.isUndefined(t[n])&&(t[n]=e[n])}).bind(this))},this),t},compose:function(){var t=Ut.call(arguments);return function(){for(var e=Ut.call(arguments),i=t.length-1;i>=0;i--)e=[t[i].apply(this,e)];return e[0]}},each:function(t,e,i){if(t){if(ai&&t.forEach&&t.forEach===ai)t.forEach(e,i);else if(t.length===t.length+0){var n=void 0,s=void 0;for(n=0,s=t.length;n<s;n++)if(n in t&&e.call(i,t[n],n)===this.BREAK)return}else for(var a in t)if(e.call(i,t[a],a)===this.BREAK)return}},defer:function(t){setTimeout(t,0)},debounce:function(t,e,i){var n=void 0;return function(){var s=this,a=arguments;function o(){n=null,i||t.apply(s,a)}var h=i||!n;clearTimeout(n),n=setTimeout(o,e),h&&t.apply(s,a)}},toArray:function(t){return t.toArray?t.toArray():Ut.call(t)},isUndefined:function(t){return t===void 0},isNull:function(t){return t===null},isNaN:function(r){function t(e){return r.apply(this,arguments)}return t.toString=function(){return r.toString()},t}(function(r){return isNaN(r)}),isArray:Array.isArray||function(r){return r.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return t===!1||t===!0},isFunction:function(t){return t instanceof Function}},Ln=[{litmus:y.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return e===null?!1:{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:zt},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return e===null?!1:{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:zt},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return e===null?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:zt},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return e===null?!1:{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:zt}}},{litmus:y.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:y.isArray,conversions:{RGB_ARRAY:{read:function(t){return t.length!==3?!1:{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return t.length!==4?!1:{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:y.isObject,conversions:{RGBA_OBJ:{read:function(t){return y.isNumber(t.r)&&y.isNumber(t.g)&&y.isNumber(t.b)&&y.isNumber(t.a)?{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}:!1},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return y.isNumber(t.r)&&y.isNumber(t.g)&&y.isNumber(t.b)?{space:"RGB",r:t.r,g:t.g,b:t.b}:!1},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return y.isNumber(t.h)&&y.isNumber(t.s)&&y.isNumber(t.v)&&y.isNumber(t.a)?{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}:!1},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return y.isNumber(t.h)&&y.isNumber(t.s)&&y.isNumber(t.v)?{space:"HSV",h:t.h,s:t.s,v:t.v}:!1},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],Dt=void 0,ne=void 0,Te=function(){ne=!1;var t=arguments.length>1?y.toArray(arguments):arguments[0];return y.each(Ln,function(e){if(e.litmus(t))return y.each(e.conversions,function(i,n){if(Dt=i.read(t),ne===!1&&Dt!==!1)return ne=Dt,Dt.conversionName=n,Dt.conversion=i,y.BREAK}),y.BREAK}),ne},oi=void 0,oe={hsv_to_rgb:function(t,e,i){var n=Math.floor(t/60)%6,s=t/60-Math.floor(t/60),a=i*(1-e),o=i*(1-s*e),h=i*(1-(1-s)*e),l=[[i,h,a],[o,i,a],[a,i,h],[a,o,i],[h,a,i],[i,a,o]][n];return{r:l[0]*255,g:l[1]*255,b:l[2]*255}},rgb_to_hsv:function(t,e,i){var n=Math.min(t,e,i),s=Math.max(t,e,i),a=s-n,o=void 0,h=void 0;if(s!==0)h=a/s;else return{h:NaN,s:0,v:0};return t===s?o=(e-i)/a:e===s?o=2+(i-t)/a:o=4+(t-e)/a,o/=6,o<0&&(o+=1),{h:o*360,s:h,v:s/255}},rgb_to_hex:function(t,e,i){var n=this.hex_with_component(0,2,t);return n=this.hex_with_component(n,1,e),n=this.hex_with_component(n,0,i),n},component_from_hex:function(t,e){return t>>e*8&255},hex_with_component:function(t,e,i){return i<<(oi=e*8)|t&~(255<<oi)}},Nn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},W=function(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")},$=function(){function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}}(),ct=function r(t,e,i){t===null&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,e);if(n===void 0){var s=Object.getPrototypeOf(t);return s===null?void 0:r(s,e,i)}else{if("value"in n)return n.value;var a=n.get;return a===void 0?void 0:a.call(i)}},ut=function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);r.prototype=Object.create(t&&t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(r,t):r.__proto__=t)},dt=function(r,t){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:r},D=function(){function r(){if(W(this,r),this.__state=Te.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return $(r,[{key:"toString",value:function(){return zt(this)}},{key:"toHexString",value:function(){return zt(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),r}();function Ne(r,t,e){Object.defineProperty(r,t,{get:function(){return this.__state.space==="RGB"?this.__state[t]:(D.recalculateRGB(this,t,e),this.__state[t])},set:function(n){this.__state.space!=="RGB"&&(D.recalculateRGB(this,t,e),this.__state.space="RGB"),this.__state[t]=n}})}function Ve(r,t){Object.defineProperty(r,t,{get:function(){return this.__state.space==="HSV"?this.__state[t]:(D.recalculateHSV(this),this.__state[t])},set:function(i){this.__state.space!=="HSV"&&(D.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=i}})}D.recalculateRGB=function(r,t,e){if(r.__state.space==="HEX")r.__state[t]=oe.component_from_hex(r.__state.hex,e);else if(r.__state.space==="HSV")y.extend(r.__state,oe.hsv_to_rgb(r.__state.h,r.__state.s,r.__state.v));else throw new Error("Corrupted color state")};D.recalculateHSV=function(r){var t=oe.rgb_to_hsv(r.r,r.g,r.b);y.extend(r.__state,{s:t.s,v:t.v}),y.isNaN(t.h)?y.isUndefined(r.__state.h)&&(r.__state.h=0):r.__state.h=t.h};D.COMPONENTS=["r","g","b","h","s","v","hex","a"];Ne(D.prototype,"r",2);Ne(D.prototype,"g",1);Ne(D.prototype,"b",0);Ve(D.prototype,"h");Ve(D.prototype,"s");Ve(D.prototype,"v");Object.defineProperty(D.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}});Object.defineProperty(D.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=oe.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var _t=function(){function r(t,e){W(this,r),this.initialValue=t[e],this.domElement=document.createElement("div"),this.object=t,this.property=e,this.__onChange=void 0,this.__onFinishChange=void 0}return $(r,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),r}(),Vn={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},bi={};y.each(Vn,function(r,t){y.each(r,function(e){bi[e]=t})});var Gn=/(\d+(\.\d+)?)px/;function Z(r){if(r==="0"||y.isUndefined(r))return 0;var t=r.match(Gn);return y.isNull(t)?0:parseFloat(t[1])}var _={makeSelectable:function(t,e){t===void 0||t.style===void 0||(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,i){var n=i,s=e;y.isUndefined(s)&&(s=!0),y.isUndefined(n)&&(n=!0),t.style.position="absolute",s&&(t.style.left=0,t.style.right=0),n&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,i,n){var s=i||{},a=bi[e];if(!a)throw new Error("Event type "+e+" not supported.");var o=document.createEvent(a);switch(a){case"MouseEvents":{var h=s.x||s.clientX||0,l=s.y||s.clientY||0;o.initMouseEvent(e,s.bubbles||!1,s.cancelable||!0,window,s.clickCount||1,0,0,h,l,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var u=o.initKeyboardEvent||o.initKeyEvent;y.defaults(s,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),u(e,s.bubbles||!1,s.cancelable,window,s.ctrlKey,s.altKey,s.shiftKey,s.metaKey,s.keyCode,s.charCode);break}default:{o.initEvent(e,s.bubbles||!1,s.cancelable||!0);break}}y.defaults(o,n),t.dispatchEvent(o)},bind:function(t,e,i,n){var s=n||!1;return t.addEventListener?t.addEventListener(e,i,s):t.attachEvent&&t.attachEvent("on"+e,i),_},unbind:function(t,e,i,n){var s=n||!1;return t.removeEventListener?t.removeEventListener(e,i,s):t.detachEvent&&t.detachEvent("on"+e,i),_},addClass:function(t,e){if(t.className===void 0)t.className=e;else if(t.className!==e){var i=t.className.split(/ +/);i.indexOf(e)===-1&&(i.push(e),t.className=i.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return _},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var i=t.className.split(/ +/),n=i.indexOf(e);n!==-1&&(i.splice(n,1),t.className=i.join(" "))}else t.className=void 0;return _},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return Z(e["border-left-width"])+Z(e["border-right-width"])+Z(e["padding-left"])+Z(e["padding-right"])+Z(e.width)},getHeight:function(t){var e=getComputedStyle(t);return Z(e["border-top-width"])+Z(e["border-bottom-width"])+Z(e["padding-top"])+Z(e["padding-bottom"])+Z(e.height)},getOffset:function(t){var e=t,i={left:0,top:0};if(e.offsetParent)do i.left+=e.offsetLeft,i.top+=e.offsetTop,e=e.offsetParent;while(e);return i},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},vi=function(r){ut(t,r);function t(e,i){W(this,t);var n=dt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),s=n;n.__prev=n.getValue(),n.__checkbox=document.createElement("input"),n.__checkbox.setAttribute("type","checkbox");function a(){s.setValue(!s.__prev)}return _.bind(n.__checkbox,"change",a,!1),n.domElement.appendChild(n.__checkbox),n.updateDisplay(),n}return $(t,[{key:"setValue",value:function(i){var n=ct(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,i);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),ct(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(_t),Hn=function(r){ut(t,r);function t(e,i,n){W(this,t);var s=dt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),a=n,o=s;if(s.__select=document.createElement("select"),y.isArray(a)){var h={};y.each(a,function(l){h[l]=l}),a=h}return y.each(a,function(l,u){var c=document.createElement("option");c.innerHTML=u,c.setAttribute("value",l),o.__select.appendChild(c)}),s.updateDisplay(),_.bind(s.__select,"change",function(){var l=this.options[this.selectedIndex].value;o.setValue(l)}),s.domElement.appendChild(s.__select),s}return $(t,[{key:"setValue",value:function(i){var n=ct(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,i);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return _.isActive(this.__select)?this:(this.__select.value=this.getValue(),ct(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(_t),qn=function(r){ut(t,r);function t(e,i){W(this,t);var n=dt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),s=n;function a(){s.setValue(s.__input.value)}function o(){s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return n.__input=document.createElement("input"),n.__input.setAttribute("type","text"),_.bind(n.__input,"keyup",a),_.bind(n.__input,"change",a),_.bind(n.__input,"blur",o),_.bind(n.__input,"keydown",function(h){h.keyCode===13&&this.blur()}),n.updateDisplay(),n.domElement.appendChild(n.__input),n}return $(t,[{key:"updateDisplay",value:function(){return _.isActive(this.__input)||(this.__input.value=this.getValue()),ct(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(_t);function hi(r){var t=r.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var wi=function(r){ut(t,r);function t(e,i,n){W(this,t);var s=dt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),a=n||{};return s.__min=a.min,s.__max=a.max,s.__step=a.step,y.isUndefined(s.__step)?s.initialValue===0?s.__impliedStep=1:s.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(s.initialValue))/Math.LN10))/10:s.__impliedStep=s.__step,s.__precision=hi(s.__impliedStep),s}return $(t,[{key:"setValue",value:function(i){var n=i;return this.__min!==void 0&&n<this.__min?n=this.__min:this.__max!==void 0&&n>this.__max&&(n=this.__max),this.__step!==void 0&&n%this.__step!==0&&(n=Math.round(n/this.__step)*this.__step),ct(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(i){return this.__min=i,this}},{key:"max",value:function(i){return this.__max=i,this}},{key:"step",value:function(i){return this.__step=i,this.__impliedStep=i,this.__precision=hi(i),this}}]),t}(_t);function Yn(r,t){var e=Math.pow(10,t);return Math.round(r*e)/e}var he=function(r){ut(t,r);function t(e,i,n){W(this,t);var s=dt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n));s.__truncationSuspended=!1;var a=s,o=void 0;function h(){var m=parseFloat(a.__input.value);y.isNaN(m)||a.setValue(m)}function l(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function u(){l()}function c(m){var p=o-m.clientY;a.setValue(a.getValue()+p*a.__impliedStep),o=m.clientY}function d(){_.unbind(window,"mousemove",c),_.unbind(window,"mouseup",d),l()}function f(m){_.bind(window,"mousemove",c),_.bind(window,"mouseup",d),o=m.clientY}return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),_.bind(s.__input,"change",h),_.bind(s.__input,"blur",u),_.bind(s.__input,"mousedown",f),_.bind(s.__input,"keydown",function(m){m.keyCode===13&&(a.__truncationSuspended=!0,this.blur(),a.__truncationSuspended=!1,l())}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return $(t,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():Yn(this.getValue(),this.__precision),ct(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(wi);function li(r,t,e,i,n){return i+(n-i)*((r-t)/(e-t))}var Be=function(r){ut(t,r);function t(e,i,n,s,a){W(this,t);var o=dt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,{min:n,max:s,step:a})),h=o;o.__background=document.createElement("div"),o.__foreground=document.createElement("div"),_.bind(o.__background,"mousedown",l),_.bind(o.__background,"touchstart",d),_.addClass(o.__background,"slider"),_.addClass(o.__foreground,"slider-fg");function l(p){document.activeElement.blur(),_.bind(window,"mousemove",u),_.bind(window,"mouseup",c),u(p)}function u(p){p.preventDefault();var g=h.__background.getBoundingClientRect();return h.setValue(li(p.clientX,g.left,g.right,h.__min,h.__max)),!1}function c(){_.unbind(window,"mousemove",u),_.unbind(window,"mouseup",c),h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())}function d(p){p.touches.length===1&&(_.bind(window,"touchmove",f),_.bind(window,"touchend",m),f(p))}function f(p){var g=p.touches[0].clientX,x=h.__background.getBoundingClientRect();h.setValue(li(g,x.left,x.right,h.__min,h.__max))}function m(){_.unbind(window,"touchmove",f),_.unbind(window,"touchend",m),h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())}return o.updateDisplay(),o.__background.appendChild(o.__foreground),o.domElement.appendChild(o.__background),o}return $(t,[{key:"updateDisplay",value:function(){var i=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=i*100+"%",ct(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(wi),Mi=function(r){ut(t,r);function t(e,i,n){W(this,t);var s=dt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i)),a=s;return s.__button=document.createElement("div"),s.__button.innerHTML=n===void 0?"Fire":n,_.bind(s.__button,"click",function(o){return o.preventDefault(),a.fire(),!1}),_.addClass(s.__button,"button"),s.domElement.appendChild(s.__button),s}return $(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(_t),Oe=function(r){ut(t,r);function t(e,i){W(this,t);var n=dt(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));n.__color=new D(n.getValue()),n.__temp=new D(0);var s=n;n.domElement=document.createElement("div"),_.makeSelectable(n.domElement,!1),n.__selector=document.createElement("div"),n.__selector.className="selector",n.__saturation_field=document.createElement("div"),n.__saturation_field.className="saturation-field",n.__field_knob=document.createElement("div"),n.__field_knob.className="field-knob",n.__field_knob_border="2px solid ",n.__hue_knob=document.createElement("div"),n.__hue_knob.className="hue-knob",n.__hue_field=document.createElement("div"),n.__hue_field.className="hue-field",n.__input=document.createElement("input"),n.__input.type="text",n.__input_textShadow="0 1px 1px ",_.bind(n.__input,"keydown",function(p){p.keyCode===13&&c.call(this)}),_.bind(n.__input,"blur",c),_.bind(n.__selector,"mousedown",function(){_.addClass(this,"drag").bind(window,"mouseup",function(){_.removeClass(s.__selector,"drag")})}),_.bind(n.__selector,"touchstart",function(){_.addClass(this,"drag").bind(window,"touchend",function(){_.removeClass(s.__selector,"drag")})});var a=document.createElement("div");y.extend(n.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),y.extend(n.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:n.__field_knob_border+(n.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),y.extend(n.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),y.extend(n.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),y.extend(a.style,{width:"100%",height:"100%",background:"none"}),ci(a,"top","rgba(0,0,0,0)","#000"),y.extend(n.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),jn(n.__hue_field),y.extend(n.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:n.__input_textShadow+"rgba(0,0,0,0.7)"}),_.bind(n.__saturation_field,"mousedown",o),_.bind(n.__saturation_field,"touchstart",o),_.bind(n.__field_knob,"mousedown",o),_.bind(n.__field_knob,"touchstart",o),_.bind(n.__hue_field,"mousedown",h),_.bind(n.__hue_field,"touchstart",h);function o(p){f(p),_.bind(window,"mousemove",f),_.bind(window,"touchmove",f),_.bind(window,"mouseup",l),_.bind(window,"touchend",l)}function h(p){m(p),_.bind(window,"mousemove",m),_.bind(window,"touchmove",m),_.bind(window,"mouseup",u),_.bind(window,"touchend",u)}function l(){_.unbind(window,"mousemove",f),_.unbind(window,"touchmove",f),_.unbind(window,"mouseup",l),_.unbind(window,"touchend",l),d()}function u(){_.unbind(window,"mousemove",m),_.unbind(window,"touchmove",m),_.unbind(window,"mouseup",u),_.unbind(window,"touchend",u),d()}function c(){var p=Te(this.value);p!==!1?(s.__color.__state=p,s.setValue(s.__color.toOriginal())):this.value=s.__color.toString()}function d(){s.__onFinishChange&&s.__onFinishChange.call(s,s.__color.toOriginal())}n.__saturation_field.appendChild(a),n.__selector.appendChild(n.__field_knob),n.__selector.appendChild(n.__saturation_field),n.__selector.appendChild(n.__hue_field),n.__hue_field.appendChild(n.__hue_knob),n.domElement.appendChild(n.__input),n.domElement.appendChild(n.__selector),n.updateDisplay();function f(p){p.type.indexOf("touch")===-1&&p.preventDefault();var g=s.__saturation_field.getBoundingClientRect(),x=p.touches&&p.touches[0]||p,S=x.clientX,A=x.clientY,M=(S-g.left)/(g.right-g.left),w=1-(A-g.top)/(g.bottom-g.top);return w>1?w=1:w<0&&(w=0),M>1?M=1:M<0&&(M=0),s.__color.v=w,s.__color.s=M,s.setValue(s.__color.toOriginal()),!1}function m(p){p.type.indexOf("touch")===-1&&p.preventDefault();var g=s.__hue_field.getBoundingClientRect(),x=p.touches&&p.touches[0]||p,S=x.clientY,A=1-(S-g.top)/(g.bottom-g.top);return A>1?A=1:A<0&&(A=0),s.__color.h=A*360,s.setValue(s.__color.toOriginal()),!1}return n}return $(t,[{key:"updateDisplay",value:function(){var i=Te(this.getValue());if(i!==!1){var n=!1;y.each(D.COMPONENTS,function(o){if(!y.isUndefined(i[o])&&!y.isUndefined(this.__color.__state[o])&&i[o]!==this.__color.__state[o])return n=!0,{}},this),n&&y.extend(this.__color.__state,i)}y.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var s=this.__color.v<.5||this.__color.s>.5?255:0,a=255-s;y.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+s+","+s+","+s+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,ci(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),y.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+s+","+s+","+s+")",textShadow:this.__input_textShadow+"rgba("+a+","+a+","+a+",.7)"})}}]),t}(_t),Xn=["-moz-","-o-","-webkit-","-ms-",""];function ci(r,t,e,i){r.style.background="",y.each(Xn,function(n){r.style.cssText+="background: "+n+"linear-gradient("+t+", "+e+" 0%, "+i+" 100%); "})}function jn(r){r.style.background="",r.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",r.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var Wn={load:function(t,e){var i=e||document,n=i.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=t,i.getElementsByTagName("head")[0].appendChild(n)},inject:function(t,e){var i=e||document,n=document.createElement("style");n.type="text/css",n.innerHTML=t;var s=i.getElementsByTagName("head")[0];try{s.appendChild(n)}catch{}}},$n=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,Zn=function(t,e){var i=t[e];return y.isArray(arguments[2])||y.isObject(arguments[2])?new Hn(t,e,arguments[2]):y.isNumber(i)?y.isNumber(arguments[2])&&y.isNumber(arguments[3])?y.isNumber(arguments[4])?new Be(t,e,arguments[2],arguments[3],arguments[4]):new Be(t,e,arguments[2],arguments[3]):y.isNumber(arguments[4])?new he(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new he(t,e,{min:arguments[2],max:arguments[3]}):y.isString(i)?new qn(t,e):y.isFunction(i)?new Mi(t,e,""):y.isBoolean(i)?new vi(t,e):null};function Jn(r){setTimeout(r,1e3/60)}var Qn=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||Jn,Kn=function(){function r(){W(this,r),this.backgroundElement=document.createElement("div"),y.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),_.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),y.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;_.bind(this.backgroundElement,"click",function(){t.hide()})}return $(r,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),y.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,i=function n(){e.domElement.style.display="none",e.backgroundElement.style.display="none",_.unbind(e.domElement,"webkitTransitionEnd",n),_.unbind(e.domElement,"transitionend",n),_.unbind(e.domElement,"oTransitionEnd",n)};_.bind(this.domElement,"webkitTransitionEnd",i),_.bind(this.domElement,"transitionend",i),_.bind(this.domElement,"oTransitionEnd",i),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-_.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-_.getHeight(this.domElement)/2+"px"}}]),r}(),tr=In(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);Wn.inject(tr);var ui="dg",di=72,fi=20,Vt="Default",Ft=function(){try{return!!window.localStorage}catch{return!1}}(),Lt=void 0,mi=!0,St=void 0,Ce=!1,Si=[],T=function r(t){var e=this,i=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),_.addClass(this.domElement,ui),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=y.defaults(i,{closeOnTop:!1,autoPlace:!0,width:r.DEFAULT_WIDTH}),i=y.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),y.isUndefined(i.load)?i.load={preset:Vt}:i.preset&&(i.load.preset=i.preset),y.isUndefined(i.parent)&&i.hideable&&Si.push(this),i.resizable=y.isUndefined(i.parent)&&i.resizable,i.autoPlace&&y.isUndefined(i.scrollable)&&(i.scrollable=!0);var n=Ft&&localStorage.getItem(At(this,"isLocal"))==="true",s=void 0,a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return e.parent?e.getRoot().preset:i.load.preset},set:function(d){e.parent?e.getRoot().preset=d:i.load.preset=d,rr(this),e.revert()}},width:{get:function(){return i.width},set:function(d){i.width=d,Ue(e,d)}},name:{get:function(){return i.name},set:function(d){i.name=d,a&&(a.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(d){i.closed=d,i.closed?_.addClass(e.__ul,r.CLASS_CLOSED):_.removeClass(e.__ul,r.CLASS_CLOSED),this.onResize(),e.__closeButton&&(e.__closeButton.innerHTML=d?r.TEXT_OPEN:r.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return n},set:function(d){Ft&&(n=d,d?_.bind(window,"unload",s):_.unbind(window,"unload",s),localStorage.setItem(At(e,"isLocal"),d))}}}),y.isUndefined(i.parent)){if(this.closed=i.closed||!1,_.addClass(this.domElement,r.CLASS_MAIN),_.makeSelectable(this.domElement,!1),Ft&&n){e.useLocalStorage=!0;var o=localStorage.getItem(At(this,"gui"));o&&(i.load=JSON.parse(o))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=r.TEXT_CLOSED,_.addClass(this.__closeButton,r.CLASS_CLOSE_BUTTON),i.closeOnTop?(_.addClass(this.__closeButton,r.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(_.addClass(this.__closeButton,r.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),_.bind(this.__closeButton,"click",function(){e.closed=!e.closed})}else{i.closed===void 0&&(i.closed=!0);var h=document.createTextNode(i.name);_.addClass(h,"controller-name"),a=Ge(e,h);var l=function(d){return d.preventDefault(),e.closed=!e.closed,!1};_.addClass(this.__ul,r.CLASS_CLOSED),_.addClass(a,"title"),_.bind(a,"click",l),i.closed||(this.closed=!1)}i.autoPlace&&(y.isUndefined(i.parent)&&(mi&&(St=document.createElement("div"),_.addClass(St,ui),_.addClass(St,r.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(St),mi=!1),St.appendChild(this.domElement),_.addClass(this.domElement,r.CLASS_AUTO_PLACE)),this.parent||Ue(e,i.width)),this.__resizeHandler=function(){e.onResizeDebounced()},_.bind(window,"resize",this.__resizeHandler),_.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),_.bind(this.__ul,"transitionend",this.__resizeHandler),_.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&nr(this),s=function(){Ft&&localStorage.getItem(At(e,"isLocal"))==="true"&&localStorage.setItem(At(e,"gui"),JSON.stringify(e.getSaveObject()))},this.saveToLocalStorageIfPossible=s;function u(){var c=e.getRoot();c.width+=1,y.defer(function(){c.width-=1})}i.parent||u()};T.toggleHide=function(){Ce=!Ce,y.each(Si,function(r){r.domElement.style.display=Ce?"none":""})};T.CLASS_AUTO_PLACE="a";T.CLASS_AUTO_PLACE_CONTAINER="ac";T.CLASS_MAIN="main";T.CLASS_CONTROLLER_ROW="cr";T.CLASS_TOO_TALL="taller-than-window";T.CLASS_CLOSED="closed";T.CLASS_CLOSE_BUTTON="close-button";T.CLASS_CLOSE_TOP="close-top";T.CLASS_CLOSE_BOTTOM="close-bottom";T.CLASS_DRAG="drag";T.DEFAULT_WIDTH=245;T.TEXT_CLOSED="Close Controls";T.TEXT_OPEN="Open Controls";T._keydownHandler=function(r){document.activeElement.type!=="text"&&(r.which===di||r.keyCode===di)&&T.toggleHide()};_.bind(window,"keydown",T._keydownHandler,!1);y.extend(T.prototype,{add:function(t,e){return Nt(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return Nt(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;y.defer(function(){e.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&St.removeChild(this.domElement);var t=this;y.each(this.__folders,function(e){t.removeFolder(e)}),_.unbind(window,"keydown",T._keydownHandler,!1),pi(this)},addFolder:function(t){if(this.__folders[t]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var i=new T(e);this.__folders[t]=i;var n=Ge(this,i.domElement);return _.addClass(n,"folder"),i},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],pi(t);var e=this;y.each(t.__folders,function(i){t.removeFolder(i)}),y.defer(function(){e.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=_.getOffset(t.__ul).top,i=0;y.each(t.__ul.childNodes,function(n){t.autoPlace&&n===t.__save_row||(i+=_.getHeight(n))}),window.innerHeight-e-fi<i?(_.addClass(t.domElement,T.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-fi+"px"):(_.removeClass(t.domElement,T.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&y.defer(function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"}),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:y.debounce(function(){this.onResize()},50),remember:function(){if(y.isUndefined(Lt)&&(Lt=new Kn,Lt.domElement.innerHTML=$n),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;y.each(Array.prototype.slice.call(arguments),function(e){t.__rememberedObjects.length===0&&ir(t),t.__rememberedObjects.indexOf(e)===-1&&t.__rememberedObjects.push(e)}),this.autoPlace&&Ue(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=re(this)),t.folders={},y.each(this.__folders,function(e,i){t.folders[i]=e.getSaveObject()}),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=re(this),Re(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[Vt]=re(this,!0)),this.load.remembered[t]=re(this),this.preset=t,Pe(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){y.each(this.__controllers,function(e){this.getRoot().load.remembered?Ai(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())},this),y.each(this.__folders,function(e){e.revert(e)}),t||Re(this.getRoot(),!1)},listen:function(t){var e=this.__listening.length===0;this.__listening.push(t),e&&Ci(this.__listening)},updateDisplay:function(){y.each(this.__controllers,function(t){t.updateDisplay()}),y.each(this.__folders,function(t){t.updateDisplay()})}});function Ge(r,t,e){var i=document.createElement("li");return t&&i.appendChild(t),e?r.__ul.insertBefore(i,e):r.__ul.appendChild(i),r.onResize(),i}function pi(r){_.unbind(window,"resize",r.__resizeHandler),r.saveToLocalStorageIfPossible&&_.unbind(window,"unload",r.saveToLocalStorageIfPossible)}function Re(r,t){var e=r.__preset_select[r.__preset_select.selectedIndex];t?e.innerHTML=e.value+"*":e.innerHTML=e.value}function er(r,t,e){if(e.__li=t,e.__gui=r,y.extend(e,{options:function(a){if(arguments.length>1){var o=e.__li.nextElementSibling;return e.remove(),Nt(r,e.object,e.property,{before:o,factoryArgs:[y.toArray(arguments)]})}if(y.isArray(a)||y.isObject(a)){var h=e.__li.nextElementSibling;return e.remove(),Nt(r,e.object,e.property,{before:h,factoryArgs:[a]})}},name:function(a){return e.__li.firstElementChild.firstElementChild.innerHTML=a,e},listen:function(){return e.__gui.listen(e),e},remove:function(){return e.__gui.remove(e),e}}),e instanceof Be){var i=new he(e.object,e.property,{min:e.__min,max:e.__max,step:e.__step});y.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(s){var a=e[s],o=i[s];e[s]=i[s]=function(){var h=Array.prototype.slice.call(arguments);return o.apply(i,h),a.apply(e,h)}}),_.addClass(t,"has-slider"),e.domElement.insertBefore(i.domElement,e.domElement.firstElementChild)}else if(e instanceof he){var n=function(a){if(y.isNumber(e.__min)&&y.isNumber(e.__max)){var o=e.__li.firstElementChild.firstElementChild.innerHTML,h=e.__gui.__listening.indexOf(e)>-1;e.remove();var l=Nt(r,e.object,e.property,{before:e.__li.nextElementSibling,factoryArgs:[e.__min,e.__max,e.__step]});return l.name(o),h&&l.listen(),l}return a};e.min=y.compose(n,e.min),e.max=y.compose(n,e.max)}else e instanceof vi?(_.bind(t,"click",function(){_.fakeEvent(e.__checkbox,"click")}),_.bind(e.__checkbox,"click",function(s){s.stopPropagation()})):e instanceof Mi?(_.bind(t,"click",function(){_.fakeEvent(e.__button,"click")}),_.bind(t,"mouseover",function(){_.addClass(e.__button,"hover")}),_.bind(t,"mouseout",function(){_.removeClass(e.__button,"hover")})):e instanceof Oe&&(_.addClass(t,"color"),e.updateDisplay=y.compose(function(s){return t.style.borderLeftColor=e.__color.toString(),s},e.updateDisplay),e.updateDisplay());e.setValue=y.compose(function(s){return r.getRoot().__preset_select&&e.isModified()&&Re(r.getRoot(),!0),s},e.setValue)}function Ai(r,t){var e=r.getRoot(),i=e.__rememberedObjects.indexOf(t.object);if(i!==-1){var n=e.__rememberedObjectIndecesToControllers[i];if(n===void 0&&(n={},e.__rememberedObjectIndecesToControllers[i]=n),n[t.property]=t,e.load&&e.load.remembered){var s=e.load.remembered,a=void 0;if(s[r.preset])a=s[r.preset];else if(s[Vt])a=s[Vt];else return;if(a[i]&&a[i][t.property]!==void 0){var o=a[i][t.property];t.initialValue=o,t.setValue(o)}}}}function Nt(r,t,e,i){if(t[e]===void 0)throw new Error('Object "'+t+'" has no property "'+e+'"');var n=void 0;if(i.color)n=new Oe(t,e);else{var s=[t,e].concat(i.factoryArgs);n=Zn.apply(r,s)}i.before instanceof _t&&(i.before=i.before.__li),Ai(r,n),_.addClass(n.domElement,"c");var a=document.createElement("span");_.addClass(a,"property-name"),a.innerHTML=n.property;var o=document.createElement("div");o.appendChild(a),o.appendChild(n.domElement);var h=Ge(r,o,i.before);return _.addClass(h,T.CLASS_CONTROLLER_ROW),n instanceof Oe?_.addClass(h,"color"):_.addClass(h,Nn(n.getValue())),er(r,h,n),r.__controllers.push(n),n}function At(r,t){return document.location.href+"."+t}function Pe(r,t,e){var i=document.createElement("option");i.innerHTML=t,i.value=t,r.__preset_select.appendChild(i),e&&(r.__preset_select.selectedIndex=r.__preset_select.length-1)}function _i(r,t){t.style.display=r.useLocalStorage?"block":"none"}function ir(r){var t=r.__save_row=document.createElement("li");_.addClass(r.domElement,"has-save"),r.__ul.insertBefore(t,r.__ul.firstChild),_.addClass(t,"save-row");var e=document.createElement("span");e.innerHTML="&nbsp;",_.addClass(e,"button gears");var i=document.createElement("span");i.innerHTML="Save",_.addClass(i,"button"),_.addClass(i,"save");var n=document.createElement("span");n.innerHTML="New",_.addClass(n,"button"),_.addClass(n,"save-as");var s=document.createElement("span");s.innerHTML="Revert",_.addClass(s,"button"),_.addClass(s,"revert");var a=r.__preset_select=document.createElement("select");if(r.load&&r.load.remembered?y.each(r.load.remembered,function(c,d){Pe(r,d,d===r.preset)}):Pe(r,Vt,!1),_.bind(a,"change",function(){for(var c=0;c<r.__preset_select.length;c++)r.__preset_select[c].innerHTML=r.__preset_select[c].value;r.preset=this.value}),t.appendChild(a),t.appendChild(e),t.appendChild(i),t.appendChild(n),t.appendChild(s),Ft){var o=document.getElementById("dg-local-explain"),h=document.getElementById("dg-local-storage"),l=document.getElementById("dg-save-locally");l.style.display="block",localStorage.getItem(At(r,"isLocal"))==="true"&&h.setAttribute("checked","checked"),_i(r,o),_.bind(h,"change",function(){r.useLocalStorage=!r.useLocalStorage,_i(r,o)})}var u=document.getElementById("dg-new-constructor");_.bind(u,"keydown",function(c){c.metaKey&&(c.which===67||c.keyCode===67)&&Lt.hide()}),_.bind(e,"click",function(){u.innerHTML=JSON.stringify(r.getSaveObject(),void 0,2),Lt.show(),u.focus(),u.select()}),_.bind(i,"click",function(){r.save()}),_.bind(n,"click",function(){var c=prompt("Enter a new preset name.");c&&r.saveAs(c)}),_.bind(s,"click",function(){r.revert()})}function nr(r){var t=void 0;r.__resize_handle=document.createElement("div"),y.extend(r.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function e(s){return s.preventDefault(),r.width+=t-s.clientX,r.onResize(),t=s.clientX,!1}function i(){_.removeClass(r.__closeButton,T.CLASS_DRAG),_.unbind(window,"mousemove",e),_.unbind(window,"mouseup",i)}function n(s){return s.preventDefault(),t=s.clientX,_.addClass(r.__closeButton,T.CLASS_DRAG),_.bind(window,"mousemove",e),_.bind(window,"mouseup",i),!1}_.bind(r.__resize_handle,"mousedown",n),_.bind(r.__closeButton,"mousedown",n),r.domElement.insertBefore(r.__resize_handle,r.domElement.firstElementChild)}function Ue(r,t){r.domElement.style.width=t+"px",r.__save_row&&r.autoPlace&&(r.__save_row.style.width=t+"px"),r.__closeButton&&(r.__closeButton.style.width=t+"px")}function re(r,t){var e={};return y.each(r.__rememberedObjects,function(i,n){var s={},a=r.__rememberedObjectIndecesToControllers[n];y.each(a,function(o,h){s[h]=t?o.initialValue:o.getValue()}),e[n]=s}),e}function rr(r){for(var t=0;t<r.__preset_select.length;t++)r.__preset_select[t].value===r.preset&&(r.__preset_select.selectedIndex=t)}function Ci(r){r.length!==0&&Qn.call(window,function(){Ci(r)}),y.each(r,function(t){t.updateDisplay()})}var sr=T;const ze={cameraP:{x:0,y:0,z:15}};class ar{constructor(t,e){b(this,"canvas");b(this,"count");b(this,"gui");b(this,"cameraGUI");b(this,"adapter");b(this,"device");b(this,"context");b(this,"format");b(this,"randomSeed");b(this,"color_buffer");b(this,"color_buffer_view");b(this,"sampler");b(this,"sceneParameters");b(this,"nodeBuffer");b(this,"triangleBuffer");b(this,"triangleIndexBuffer");b(this,"sky_texture");b(this,"obj_texture1");b(this,"cameraBuffer");b(this,"dirLight");b(this,"ray_tracing_pipeline");b(this,"ray_tracing_bind_group_layout");b(this,"ray_tracing_bind_group");b(this,"screen_pipeline");b(this,"screen_bind_group_layout");b(this,"screen_bind_group");b(this,"scene");b(this,"frametime");b(this,"loaded");b(this,"render",()=>{let t=performance.now();this.prepareScene(t);const e=this.device.createCommandEncoder(),i=e.beginComputePass();i.setPipeline(this.ray_tracing_pipeline),i.setBindGroup(0,this.ray_tracing_bind_group),i.dispatchWorkgroups(this.canvas.width/16,this.canvas.height/16,1),i.end();const n=this.context.getCurrentTexture().createView(),s=e.beginRenderPass({colorAttachments:[{view:n,clearValue:{r:.5,g:0,b:.25,a:1},loadOp:"clear",storeOp:"store"}]});s.setPipeline(this.screen_pipeline),s.setBindGroup(0,this.screen_bind_group),s.draw(6,1,0,0),s.end(),this.device.queue.submit([e.finish()]),this.device.queue.onSubmittedWorkDone().then(()=>{let a=performance.now();this.frametime=a-t;let o=document.getElementById("render-time");o&&(o.innerText=this.frametime.toString())}),requestAnimationFrame(this.render)});this.canvas=t,this.scene=e,this.dirLight=[-1,-1,-1,1],this.count=0,this.gui=new sr,this.cameraGUI=this.gui.addFolder("相机控件")}async Initialize(){this.setGUI(),await this.setupDevice(),await this.makeBindGroupLayouts(),await this.createAssets(),await this.makeBindGroups(),await this.makePipelines(),this.frametime=16,this.loaded=!1,this.render()}setGUI(){this.cameraGUI.add(ze.cameraP,"x").min(-40).max(40).step(2).name("Camera-X").onChange(t=>{this.scene.camera.position[0]=t}),this.cameraGUI.add(ze.cameraP,"y").min(-40).max(40).step(2).name("Camera-Y").onChange(t=>{this.scene.camera.position[1]=t}),this.cameraGUI.add(ze.cameraP,"z").min(-40).max(40).step(2).name("Camera-Z").onChange(t=>{this.scene.camera.position[2]=t})}async setupDevice(){var t,e;if(!navigator.gpu)throw new Error("Not Support WebGPU");if(this.adapter=await((t=navigator.gpu)==null?void 0:t.requestAdapter()),!this.adapter)throw new Error("No Adapter Found");this.device=await this.adapter.requestDevice(),this.context=this.canvas.getContext("webgpu"),this.format="bgra8unorm",(e=this.context)==null||e.configure({device:this.device,format:this.format,alphaMode:"opaque"})}async makeBindGroupLayouts(){this.ray_tracing_bind_group_layout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,storageTexture:{access:"write-only",format:"rgba8unorm",viewDimension:"2d"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage",hasDynamicOffset:!1}},{binding:3,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage",hasDynamicOffset:!1}},{binding:4,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage",hasDynamicOffset:!1}},{binding:5,visibility:GPUShaderStage.COMPUTE,texture:{viewDimension:"cube"}},{binding:6,visibility:GPUShaderStage.COMPUTE,sampler:{}},{binding:7,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:8,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:9,visibility:GPUShaderStage.COMPUTE,texture:{}}]}),this.screen_bind_group_layout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,sampler:{}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{}}]})}async createAssets(){this.color_buffer=this.device.createTexture({size:{width:this.canvas.width,height:this.canvas.height},format:"rgba8unorm",usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.TEXTURE_BINDING}),this.color_buffer_view=this.color_buffer.createView();const t={addressModeU:"repeat",addressModeV:"repeat",magFilter:"linear",minFilter:"nearest",mipmapFilter:"nearest",maxAnisotropy:1};this.sampler=this.device.createSampler(t);const e={label:"sceneParameters",size:144,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST};this.sceneParameters=this.device.createBuffer(e),this.randomSeed=this.device.createBuffer({label:"Camera Position Buffer",size:4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const i={size:40*4*this.scene.triangleCount,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST};this.triangleBuffer=this.device.createBuffer(i);const n={size:4*this.scene.triangleCount,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST};this.triangleIndexBuffer=this.device.createBuffer(n);const s={label:"nodeBuffer",size:32*this.scene.nodesUsed,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST};this.nodeBuffer=this.device.createBuffer(s);const a=["public/3/px.jpg","public/3/nx.jpg","public/3/py.jpg","public/3/ny.jpg","public/3/pz.jpg","public/3/nz.jpg"];this.sky_texture=new Fn,await this.sky_texture.initialize(this.device,a),this.cameraBuffer=this.device.createBuffer({label:"CameraBuffer",size:16*4*2,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM});{const o=await fetch(new URL("/webgpu-ray-tracing-demo/imgs/sphere.jpg",import.meta.url).toString()),h=await createImageBitmap(await o.blob());this.obj_texture1=this.device.createTexture({size:[h.width,h.height,1],format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT}),this.device.queue.copyExternalImageToTexture({source:h},{texture:this.obj_texture1},[h.width,h.height])}}async makeBindGroups(){this.ray_tracing_bind_group=this.device.createBindGroup({layout:this.ray_tracing_bind_group_layout,entries:[{binding:0,resource:this.color_buffer_view},{binding:1,resource:{buffer:this.sceneParameters}},{binding:2,resource:{buffer:this.triangleBuffer}},{binding:3,resource:{buffer:this.nodeBuffer}},{binding:4,resource:{buffer:this.triangleIndexBuffer}},{binding:5,resource:this.sky_texture.view},{binding:6,resource:this.sky_texture.sampler},{binding:7,resource:{buffer:this.randomSeed}},{binding:8,resource:{buffer:this.cameraBuffer}},{binding:9,resource:this.obj_texture1.createView()}]}),this.screen_bind_group=this.device.createBindGroup({layout:this.screen_bind_group_layout,entries:[{binding:0,resource:this.sampler},{binding:1,resource:this.color_buffer_view}]})}async makePipelines(){const t=this.device.createPipelineLayout({bindGroupLayouts:[this.ray_tracing_bind_group_layout]});this.ray_tracing_pipeline=this.device.createComputePipeline({layout:t,compute:{module:this.device.createShaderModule({code:Dn}),entryPoint:"main"}});const e=this.device.createPipelineLayout({bindGroupLayouts:[this.screen_bind_group_layout]});this.screen_pipeline=this.device.createRenderPipeline({layout:e,vertex:{module:this.device.createShaderModule({code:si}),entryPoint:"vert_main"},fragment:{module:this.device.createShaderModule({code:si}),entryPoint:"frag_main",targets:[{format:"bgra8unorm"}]},primitive:{topology:"triangle-list"}})}prepareScene(t){this.count++,this.scene.camera.recalculateProjection(),this.scene.camera.updatePos();let e=pt(0,0,3);et(e,this.scene.camera.forwardDirection,this.scene.camera.upDirection),et(this.scene.camera.upDirection,e,this.scene.camera.forwardDirection);const i=new Float32Array(this.scene.camera.inverseProjection.length+this.scene.camera.inverseView.length);i.set(this.scene.camera.inverseProjection),i.set(this.scene.camera.inverseView,this.scene.camera.inverseProjection.length),this.device.queue.writeBuffer(this.cameraBuffer,0,i);const n={cameraPos:this.scene.camera.position,cameraForwards:this.scene.camera.forwardDirection,cameraRight:e,cameraUp:this.scene.camera.upDirection,triangleCount:this.scene.triangleCount,inverseModel:this.scene.statue.inverseModel,dirLight:this.dirLight},s=4;if(this.dirLight[0]=Math.sin(t/1500),this.dirLight[2]=Math.cos(t/1500),this.device.queue.writeBuffer(this.sceneParameters,0,new Float32Array([n.cameraPos[0],n.cameraPos[1],n.cameraPos[2],0,n.cameraForwards[0],n.cameraForwards[1],n.cameraForwards[2],0,n.cameraRight[0],n.cameraRight[1],n.cameraRight[2],s,n.cameraUp[0],n.cameraUp[1],n.cameraUp[2],n.triangleCount,...n.inverseModel,...this.dirLight]),0,36),this.loaded)return;this.loaded=!0;const a=new Float32Array(40*this.scene.triangleCount);for(let c=0;c<this.scene.triangleCount;c++){for(var o=0;o<3;o++)a[40*c+8*o]=this.scene.triangles[c].corners[o][0],a[40*c+8*o+1]=this.scene.triangles[c].corners[o][1],a[40*c+8*o+2]=this.scene.triangles[c].corners[o][2],a[40*c+8*o+3]=0,a[40*c+8*o+4]=this.scene.triangles[c].normals[o][0],a[40*c+8*o+5]=this.scene.triangles[c].normals[o][1],a[40*c+8*o+6]=this.scene.triangles[c].normals[o][2],a[40*c+8*o+7]=0;for(var h=0;h<3;h++)a[40*c+24+h]=this.scene.triangles[c].color[h];a[40*c+27]=0,a[40*c+28]=this.scene.triangles[c].uvs[0][0],a[40*c+29]=this.scene.triangles[c].uvs[0][1],a[40*c+30]=0,a[40*c+31]=0,a[40*c+32]=this.scene.triangles[c].uvs[1][0],a[40*c+33]=this.scene.triangles[c].uvs[1][1],a[40*c+34]=0,a[40*c+35]=0,a[40*c+36]=this.scene.triangles[c].uvs[2][0],a[40*c+37]=this.scene.triangles[c].uvs[2][1],a[40*c+38]=0,a[40*c+39]=0}this.device.queue.writeBuffer(this.triangleBuffer,0,a,0,40*this.scene.triangleCount);const l=new Float32Array(8*this.scene.nodesUsed);for(let c=0;c<this.scene.nodesUsed;c++)l[8*c]=this.scene.nodes[c].minCorner[0],l[8*c+1]=this.scene.nodes[c].minCorner[1],l[8*c+2]=this.scene.nodes[c].minCorner[2],l[8*c+3]=this.scene.nodes[c].leftChild,l[8*c+4]=this.scene.nodes[c].maxCorner[0],l[8*c+5]=this.scene.nodes[c].maxCorner[1],l[8*c+6]=this.scene.nodes[c].maxCorner[2],l[8*c+7]=this.scene.nodes[c].primitiveCount;this.device.queue.writeBuffer(this.nodeBuffer,0,l,0,8*this.scene.nodesUsed);const u=new Float32Array(this.scene.triangleCount);for(let c=0;c<this.scene.triangleCount;c++)u[c]=this.scene.triangleIndices[c];this.device.queue.writeBuffer(this.triangleIndexBuffer,0,u,0,this.scene.triangleCount),this.device.queue.writeBuffer(this.randomSeed,0,new Float32Array([Math.random()]))}}const or=async()=>{const r=document.getElementById("gfx-main"),t=document.getElementById("triangle-count"),e=new Un(r);await e.make_scene(),t.innerText=e.triangleCount.toString();const i=new ar(r,e);await i.Initialize(),i.render()};or();
